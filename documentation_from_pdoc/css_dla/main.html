<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.4.0"/>
    <title>css_dla.main API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../css_dla.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;css_dla</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="variable" href="#DEBUG">DEBUG</a>
            </li>
            <li>
                    <a class="variable" href="#NO_STRUCTURE">NO_STRUCTURE</a>
            </li>
            <li>
                    <a class="variable" href="#STRUCTURE">STRUCTURE</a>
            </li>
            <li>
                    <a class="variable" href="#DEFAULT_BUFFER_SIZE">DEFAULT_BUFFER_SIZE</a>
            </li>
            <li>
                    <a class="variable" href="#R_SCALING_FACTOR">R_SCALING_FACTOR</a>
            </li>
            <li>
                    <a class="variable" href="#FOCAL_ATTRACTION">FOCAL_ATTRACTION</a>
            </li>
            <li>
                    <a class="variable" href="#DIRECTIONAL_DRIFT">DIRECTIONAL_DRIFT</a>
            </li>
            <li>
                    <a class="variable" href="#DIRECTIONS">DIRECTIONS</a>
            </li>
            <li>
                    <a class="variable" href="#LEN_DIRECTIONS">LEN_DIRECTIONS</a>
            </li>
            <li>
                    <a class="function" href="#my_random_function">my_random_function</a>
            </li>
            <li>
                    <a class="function" href="#assert_if_debug">assert_if_debug</a>
            </li>
            <li>
                    <a class="function" href="#is_numeric">is_numeric</a>
            </li>
            <li>
                    <a class="class" href="#Model">Model</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Model.__init__">Model</a>
                        </li>
                        <li>
                                <a class="variable" href="#Model.w">w</a>
                        </li>
                        <li>
                                <a class="variable" href="#Model.h">h</a>
                        </li>
                        <li>
                                <a class="variable" href="#Model.grid">grid</a>
                        </li>
                        <li>
                                <a class="variable" href="#Model.mode">mode</a>
                        </li>
                        <li>
                                <a class="variable" href="#Model.direction_index">direction_index</a>
                        </li>
                        <li>
                                <a class="variable" href="#Model.particle_generation">particle_generation</a>
                        </li>
                        <li>
                                <a class="function" href="#Model.loop">loop</a>
                        </li>
                        <li>
                                <a class="function" href="#Model.focal_attraction">focal_attraction</a>
                        </li>
                        <li>
                                <a class="function" href="#Model.directional_drift">directional_drift</a>
                        </li>
                        <li>
                                <a class="function" href="#Model.growing_radius">growing_radius</a>
                        </li>
                        <li>
                                <a class="function" href="#Model.norm_vector_to_center">norm_vector_to_center</a>
                        </li>
                        <li>
                                <a class="function" href="#Model.distance">distance</a>
                        </li>
                        <li>
                                <a class="function" href="#Model.update">update</a>
                        </li>
                        <li>
                                <a class="function" href="#Model.update_random_walk">update_random_walk</a>
                        </li>
                        <li>
                                <a class="function" href="#Model.get_box_count">get_box_count</a>
                        </li>
                        <li>
                                <a class="function" href="#Model.get_fractal_dim">get_fractal_dim</a>
                        </li>
                        <li>
                                <a class="function" href="#Model.density_gradient">density_gradient</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../css_dla.html">css_dla</a><wbr>.main    </h1>

                        <div class="docstring"><p>This module contains the model of the city using the DLA mechanism.</p>

<p>The model is represented by a grid of size w*h, where each cell can be either empty or contain a city.
The model is initialized with a single city at the center of the grid, or with two cities at the center of each half of the grid.
The model is updated by spawning a particle at a random point on the edge of a circle with a radius that grows logarithmically as a function of structure size.
The particle then moves randomly until it encounters an established structure.
The particle then becomes a city and the process repeats.
The model can be run for a given number of iterations using the loop method.</p>
</div>

                        <input id="mod-main-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-main-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="sd">This module contains the model of the city using the DLA mechanism.</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="sd">The model is represented by a grid of size w*h, where each cell can be either empty or contain a city.</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="sd">The model is initialized with a single city at the center of the grid, or with two cities at the center of each half of the grid.</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="sd">The model is updated by spawning a particle at a random point on the edge of a circle with a radius that grows logarithmically as a function of structure size.</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="sd">The particle then moves randomly until it encounters an established structure.</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="sd">The particle then becomes a city and the process repeats.</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="sd">The model can be run for a given number of iterations using the loop method.</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">curve_fit</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="kn">import</span> <span class="nn">random</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="kn">import</span> <span class="nn">math</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="c1"># Debug mode means that assertions will be checked</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="n">DEBUG</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="n">NO_STRUCTURE</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="n">STRUCTURE</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="n">DEFAULT_BUFFER_SIZE</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="n">R_SCALING_FACTOR</span> <span class="o">=</span> <span class="mi">20</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="n">FOCAL_ATTRACTION</span> <span class="o">=</span> <span class="mf">0.2</span>  <span class="c1"># Between 0 and 1</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="n">DIRECTIONAL_DRIFT</span> <span class="o">=</span> <span class="mf">0.2</span>  <span class="c1"># Between 0 and 1</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="n">DIRECTIONS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a>    <span class="p">[</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a>        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>  <span class="c1"># N</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a>        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>  <span class="c1"># NE</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a>        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>  <span class="c1"># E</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a>        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>  <span class="c1"># SE</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a>        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>  <span class="c1"># S</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a>        <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>  <span class="c1"># SW</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a>        <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>  <span class="c1"># W</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a>        <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>  <span class="c1"># NW</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a>    <span class="p">]</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a><span class="p">)</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="n">LEN_DIRECTIONS</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">DIRECTIONS</span><span class="p">)</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="k">def</span> <span class="nf">my_random_function</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Choose a random element from a collection based on the given probabilities.</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a><span class="sd">    Faster than np.random.choice for small collections.</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a><span class="sd">    Based on: https://stackoverflow.com/questions/18622781/why-is-numpy-random-choice-so-slow</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a><span class="sd">    :param collection: The collection to choose from</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a><span class="sd">    :param p: The probabilities of choosing each element</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a><span class="sd">    :return: The chosen element</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a>        <span class="n">collection</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">collection</span><span class="p">))</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a>    <span class="n">miles</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a>    <span class="n">current</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a>    <span class="k">for</span> <span class="n">prob</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a>        <span class="n">miles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a>        <span class="n">current</span> <span class="o">+=</span> <span class="n">prob</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a>    <span class="k">assert</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;Probabilities must sum to 1&quot;</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>    <span class="n">_all</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">miles</span><span class="p">))</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">_all</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a>        <span class="k">if</span> <span class="n">_all</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">_all</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">x</span><span class="p">:</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a>            <span class="n">_all</span> <span class="o">=</span> <span class="n">_all</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">_all</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">:]</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>            <span class="n">_all</span> <span class="o">=</span> <span class="n">_all</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">_all</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">]</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>    <span class="k">return</span> <span class="n">_all</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a><span class="k">def</span> <span class="nf">assert_if_debug</span><span class="p">(</span><span class="n">condition</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Assert that the condition is true if the program is in debug mode.</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a><span class="sd">    :param condition: The condition to check</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a><span class="sd">    :param message: The message to display if the condition is false</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a>    <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>        <span class="k">assert</span> <span class="nb">eval</span><span class="p">(</span><span class="n">condition</span><span class="p">),</span> <span class="n">message</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a><span class="k">def</span> <span class="nf">is_numeric</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if the object is numeric.</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a><span class="sd">    :param obj: The object to check</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a><span class="sd">    :return: Whether the object is numeric</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>    <span class="n">attrs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;__add__&quot;</span><span class="p">,</span> <span class="s2">&quot;__sub__&quot;</span><span class="p">,</span> <span class="s2">&quot;__mul__&quot;</span><span class="p">,</span> <span class="s2">&quot;__truediv__&quot;</span><span class="p">,</span> <span class="s2">&quot;__pow__&quot;</span><span class="p">]</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>    <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span> <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">)</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a><span class="k">class</span> <span class="nc">Model</span><span class="p">:</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;This class represents the model of the city.</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a><span class="sd">    It contains the grid and the methods modify it, as well as different calculations for the model.</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>        <span class="n">w</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>        <span class="n">h</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a>        <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;multiple&quot;</span><span class="p">,</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>        <span class="n">particle_generation</span><span class="o">=</span><span class="s2">&quot;on_radius&quot;</span><span class="p">,</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>        <span class="n">seed</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the model with a grid of size w*h.</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a><span class="sd">        :param w: The width of the grid</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a><span class="sd">        :param h: The height of the grid</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a><span class="sd">        :param mode: The mode of the model. Either &#39;single&#39; or &#39;multiple&#39;</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>        <span class="k">assert</span> <span class="n">mode</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a>            <span class="s2">&quot;single&quot;</span><span class="p">,</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>            <span class="s2">&quot;multiple&quot;</span><span class="p">,</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>        <span class="p">],</span> <span class="s2">&quot;Mode must be either &#39;single&#39; or &#39;multiple&#39;&quot;</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>        <span class="k">assert</span> <span class="n">w</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">h</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Width and height must be positive&quot;</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>            <span class="n">w</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>            <span class="n">h</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="s2">&quot;Width and height must be integers&quot;</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>        <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="n">w</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="n">h</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">))</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">direction_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;single&quot;</span><span class="p">:</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>            <span class="c1"># Set the center of the grid to be a city</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">//</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">STRUCTURE</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;multiple&quot;</span><span class="p">:</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>            <span class="c1"># Place two centers for each settlement</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">//</span> <span class="mi">7</span><span class="p">),</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">//</span> <span class="mi">7</span><span class="p">)]</span> <span class="o">=</span> <span class="n">STRUCTURE</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">//</span> <span class="mi">7</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">//</span> <span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">STRUCTURE</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">particle_generation</span> <span class="o">=</span> <span class="n">particle_generation</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>        <span class="n">assert_if_debug</span><span class="p">(</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>            <span class="s2">&quot;np.count_nonzero(self.grid) &gt;= 1&quot;</span><span class="p">,</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>            <span class="s2">&quot;There should be at least one city at the start&quot;</span><span class="p">,</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>        <span class="p">)</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>    <span class="k">def</span> <span class="nf">loop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">stickiness</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Run the model for `n&#39; iterations.</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a><span class="sd">        :param n: The number of iterations to run the model for</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a><span class="sd">        :param stickiness: The stickiness of the model. Between 0 and 1</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>        <span class="c1"># Assert that the argument n is valid</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>        <span class="k">assert</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Number of iterations must be positive&quot;</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="s2">&quot;Number of iterations must be an integer&quot;</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>        <span class="c1"># Assert that the argument stickiness is valid</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>        <span class="k">assert</span> <span class="n">stickiness</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">stickiness</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Stickiness must be between 0 and 1&quot;</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stickiness</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span> <span class="s2">&quot;Stickiness must be a float&quot;</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">stickiness</span><span class="p">)</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>    <span class="k">def</span> <span class="nf">focal_attraction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">normalized_vector_to_center</span><span class="p">):</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Given normalized vector from current position to the center, this function</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a><span class="sd">        assigns probabilites to the directions of next move. Directions to the center</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a><span class="sd">        are more likely due to focal attraction property.</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a><span class="sd">        :param normalized_vector_to_center: The normalized vector from the current position to the center</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a><span class="sd">        :return: The probabilities of the next move</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>        <span class="c1"># Assert that the argument normalized_vector_to_center is valid</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a>        <span class="k">assert</span> <span class="n">normalized_vector_to_center</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>            <span class="mi">2</span><span class="p">,),</span> <span class="s2">&quot;Vector must be 2-dimensional&quot;</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>        <span class="n">assert_if_debug</span><span class="p">(</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>            <span class="s2">&quot;np.isclose(np.linalg.norm(normalized_vector_to_center), 1)&quot;</span><span class="p">,</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>            <span class="s2">&quot;Vector must be normalized&quot;</span><span class="p">,</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>        <span class="p">)</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>        <span class="c1"># Calculate dot products to see which direction most aligns with the</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>        <span class="c1"># vector</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>        <span class="n">dot_prods</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">DIRECTIONS</span><span class="p">,</span> <span class="n">normalized_vector_to_center</span><span class="p">)</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>        <span class="c1"># Remove negative values</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>        <span class="n">positive_dot_prods</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">dot_prods</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>        <span class="c1"># Calculate probabilities (based on focal attraction)</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>        <span class="n">uniform_probs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">LEN_DIRECTIONS</span><span class="p">)</span> <span class="o">/</span> <span class="n">LEN_DIRECTIONS</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>        <span class="n">normalized_dot_prods</span> <span class="o">=</span> <span class="n">positive_dot_prods</span> <span class="o">/</span> <span class="n">positive_dot_prods</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>        <span class="n">probabilities_focal_attraction</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">FOCAL_ATTRACTION</span><span class="p">)</span> <span class="o">*</span> <span class="n">uniform_probs</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>            <span class="n">FOCAL_ATTRACTION</span> <span class="o">*</span> <span class="n">normalized_dot_prods</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>        <span class="p">)</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>        <span class="c1"># Assert that probabilities sum to 1</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>        <span class="n">assert_if_debug</span><span class="p">(</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>            <span class="s2">&quot;np.isclose(probabilities_focal_attraction.sum(), 1)&quot;</span><span class="p">,</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>            <span class="s2">&quot;Probabilities must sum to 1&quot;</span><span class="p">,</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>        <span class="p">)</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>        <span class="k">return</span> <span class="n">probabilities_focal_attraction</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>    <span class="k">def</span> <span class="nf">directional_drift</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Given the previous direction, this function assigns probabilites</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a><span class="sd">        to the directions of next move. Directions forward (with respect to the</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a><span class="sd">        previous direction) are more likely due to directional drift.</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a><span class="sd">        :return: The probabilities of the next move</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>        <span class="c1"># Calculate probabilities (based on directional drift)</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>        <span class="n">uniform_probs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">LEN_DIRECTIONS</span><span class="p">)</span> <span class="o">/</span> <span class="n">LEN_DIRECTIONS</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>        <span class="n">max_directional_drift_probs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">LEN_DIRECTIONS</span><span class="p">)</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>        <span class="n">max_directional_drift_probs</span><span class="p">[</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">direction_index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">LEN_DIRECTIONS</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a>        <span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a>            <span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a>        <span class="p">)</span>  <span class="c1"># Previous element</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>        <span class="n">max_directional_drift_probs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">direction_index</span> <span class="o">%</span> <span class="n">LEN_DIRECTIONS</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a>            <span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>        <span class="p">)</span>  <span class="c1"># Current element</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>        <span class="n">max_directional_drift_probs</span><span class="p">[</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">direction_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">LEN_DIRECTIONS</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>        <span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>            <span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>        <span class="p">)</span>  <span class="c1"># Next element</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>        <span class="n">probabilities_directional_drift</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">DIRECTIONAL_DRIFT</span><span class="p">)</span> <span class="o">*</span> <span class="n">uniform_probs</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>            <span class="n">DIRECTIONAL_DRIFT</span> <span class="o">*</span> <span class="n">max_directional_drift_probs</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>        <span class="p">)</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>        <span class="c1"># Assert that probabilities sum to 1</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>        <span class="n">assert_if_debug</span><span class="p">(</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>            <span class="s2">&quot;np.isclose(probabilities_directional_drift.sum(), 1)&quot;</span><span class="p">,</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>            <span class="s2">&quot;Probabilities must sum to 1&quot;</span><span class="p">,</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>        <span class="p">)</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>        <span class="k">return</span> <span class="n">probabilities_directional_drift</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>    <span class="k">def</span> <span class="nf">growing_radius</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates the radius where the particles appear. This radius</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a><span class="sd">        grows logarithmically as a function of structure size</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a><span class="sd">        :return: The radius where the particles appear</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a>        <span class="n">radius</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">R_SCALING_FACTOR</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>        <span class="k">assert</span> <span class="n">radius</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Radius must be positive, check R_SCALING_FACTOR.&quot;</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>        <span class="c1"># Return the radius if it is within bounds, otherwise return the</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>        <span class="c1"># maximum possible radius</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>        <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>    <span class="k">def</span> <span class="nf">norm_vector_to_center</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">center_x</span><span class="p">,</span> <span class="n">center_y</span><span class="p">):</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Takes coordinates of current position and coordinates of some</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a><span class="sd">        center (settlement). Returns a normalized vector to that center.</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a><span class="sd">        :param x: The x-coordinate of the current position</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a><span class="sd">        :param y: The y-coordinate of the current position</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a><span class="sd">        :param center_x: The x-coordinate of the center</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a><span class="sd">        :param center_y: The y-coordinate of the center</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a><span class="sd">        :return: The normalized vector to the center</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>        <span class="c1"># Assert that the arguments are valid</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>        <span class="k">assert</span> <span class="p">(</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>            <span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>        <span class="p">),</span> <span class="s2">&quot;Current position must be within bounds&quot;</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>        <span class="k">assert</span> <span class="p">(</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>            <span class="n">center_x</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">center_x</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="ow">and</span> <span class="n">center_y</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">center_y</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>        <span class="p">),</span> <span class="s2">&quot;Center must be within bounds&quot;</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a>        <span class="c1"># Get vector pointing to the center from current position</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>        <span class="n">vector_to_center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">center_x</span> <span class="o">-</span> <span class="n">x</span><span class="p">,</span> <span class="n">center_y</span> <span class="o">-</span> <span class="n">y</span><span class="p">])</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a>        <span class="c1"># Get the norm of the vector, but faster than numpy :)</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>        <span class="n">norm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">center_x</span><span class="p">,</span> <span class="n">center_y</span><span class="p">)</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>        <span class="c1"># Normalize vector</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a>        <span class="k">if</span> <span class="n">norm</span><span class="p">:</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a>            <span class="n">normalized_vector_to_center</span> <span class="o">=</span> <span class="n">vector_to_center</span> <span class="o">/</span> <span class="n">norm</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a>            <span class="n">normalized_vector_to_center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>        <span class="k">return</span> <span class="n">normalized_vector_to_center</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>    <span class="k">def</span> <span class="nf">distance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">):</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates distance between two coordinates.</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a><span class="sd">        :param x1: The x-coordinate of the first point</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a><span class="sd">        :param y1: The y-coordinate of the first point</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a><span class="sd">        :param x2: The x-coordinate of the second point</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a><span class="sd">        :param y2: The y-coordinate of the second point</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a><span class="sd">        :return: The distance between the two points</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>        <span class="n">assert_if_debug</span><span class="p">(</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a>            <span class="s2">&quot;is_numeric(x1) and is_numeric(y1) and is_numeric(x2) and is_numeric(y2)&quot;</span><span class="p">,</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>            <span class="s2">&quot;Coordinates must be numeric&quot;</span><span class="p">,</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>        <span class="p">)</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stickiness</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Spawns a particle and calculates its next coordinate, taking into account</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a><span class="sd">        the directional drift and focal attraction. If multiple settlements are considered,</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a><span class="sd">        the particle is more likely to head in the direction of the closer one.</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a><span class="sd">        Places a settlement once the particle encounters an established structure.</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a><span class="sd">        Stops if movement goes off the grid.</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a><span class="sd">        :param stickiness: The stickiness of the model. Between 0 and 1</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a>        <span class="k">assert</span> <span class="n">stickiness</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">stickiness</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Stickiness must be between 0 and 1&quot;</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a>        <span class="c1"># Reset initial direction</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">direction_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a>        <span class="c1"># Set grid center coordinates</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a>        <span class="n">center_x</span><span class="p">,</span> <span class="n">center_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a>        <span class="c1"># For multiple settlements define multiple center points</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;multiple&quot;</span><span class="p">:</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>            <span class="n">center1_x</span><span class="p">,</span> <span class="n">center1_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">//</span> <span class="mi">4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">//</span> <span class="mi">4</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a>            <span class="n">center2_x</span><span class="p">,</span> <span class="n">center2_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">//</span> <span class="mi">4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">//</span> <span class="mi">4</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a>            <span class="n">settlement_centers</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a>                <span class="p">[</span><span class="n">center1_x</span><span class="p">,</span> <span class="n">center1_y</span><span class="p">],</span> <span class="p">[</span><span class="n">center2_x</span><span class="p">,</span> <span class="n">center2_y</span><span class="p">]]</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">particle_generation</span> <span class="o">==</span> <span class="s2">&quot;on_radius&quot;</span><span class="p">:</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a>            <span class="c1"># Set growing radius</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a>            <span class="n">radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">growing_radius</span><span class="p">()</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a>            <span class="c1"># Set the walker to be a particle at a random point on the edge of</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a>            <span class="c1"># a circle</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a>            <span class="n">angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>            <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">center_x</span> <span class="o">+</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">))</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a>            <span class="n">y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">center_y</span> <span class="o">+</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">))</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">particle_generation</span> <span class="o">==</span> <span class="s2">&quot;anywhere&quot;</span><span class="p">:</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a>            <span class="c1"># Spawn particle randomly</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a>            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">)</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a>            <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">)</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a>        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="o">==</span> <span class="n">NO_STRUCTURE</span><span class="p">:</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a>            <span class="n">old_x</span><span class="p">,</span> <span class="n">old_y</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;single&quot;</span><span class="p">:</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>                <span class="n">normalized_vector_to_center</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm_vector_to_center</span><span class="p">(</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>                    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">center_x</span><span class="p">,</span> <span class="n">center_y</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a>                <span class="p">)</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;multiple&quot;</span><span class="p">:</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>                <span class="c1"># Choose a city to go to by calculating probabilites based on</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>                <span class="c1"># which one is closest</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a>                <span class="n">distances_to_settlements</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">center1_x</span><span class="p">,</span> <span class="n">center1_y</span><span class="p">),</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">center2_x</span><span class="p">,</span> <span class="n">center2_y</span><span class="p">),</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>                <span class="p">]</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a>                <span class="n">city_choice_probabilities</span> <span class="o">=</span> <span class="n">distances_to_settlements</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a>                    <span class="n">distances_to_settlements</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>                <span class="p">)</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>                <span class="n">city_chosen_index</span> <span class="o">=</span> <span class="n">my_random_function</span><span class="p">(</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>                    <span class="nb">len</span><span class="p">(</span><span class="n">distances_to_settlements</span><span class="p">),</span> <span class="n">p</span><span class="o">=</span><span class="n">city_choice_probabilities</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>                <span class="p">)</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a>                <span class="c1"># Get a normalized vector to chosen center</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a>                <span class="n">center_x</span><span class="p">,</span> <span class="n">center_y</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>                    <span class="n">settlement_centers</span><span class="p">[</span><span class="n">city_chosen_index</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a>                    <span class="n">settlement_centers</span><span class="p">[</span><span class="n">city_chosen_index</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>                <span class="p">)</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>                <span class="n">normalized_vector_to_center</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm_vector_to_center</span><span class="p">(</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>                    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">center_x</span><span class="p">,</span> <span class="n">center_y</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>                <span class="p">)</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>            <span class="c1"># Take into account directional drift and focal attraction</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a>            <span class="n">probabilities_focal_attraction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">focal_attraction</span><span class="p">(</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a>                <span class="n">normalized_vector_to_center</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a>            <span class="p">)</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a>            <span class="n">probabilities_directional_drift</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">directional_drift</span><span class="p">()</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a>            <span class="c1"># Combine directional drift and focal attraction</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a>            <span class="n">probabilities</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a>                <span class="n">probabilities_focal_attraction</span> <span class="o">+</span> <span class="n">probabilities_directional_drift</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a>            <span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>            <span class="c1"># Choose direction and move</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">direction_index</span> <span class="o">=</span> <span class="n">my_random_function</span><span class="p">(</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a>                <span class="n">LEN_DIRECTIONS</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">probabilities</span><span class="p">)</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a>            <span class="n">direction</span> <span class="o">=</span> <span class="n">DIRECTIONS</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">direction_index</span><span class="p">]</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a>            <span class="n">x</span> <span class="o">+=</span> <span class="n">direction</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a>            <span class="n">y</span> <span class="o">+=</span> <span class="n">direction</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a>            <span class="c1"># Check if the walker is within bounds</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a>            <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="ow">or</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">y</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">:</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a>                <span class="k">return</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="o">!=</span> <span class="n">NO_STRUCTURE</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a>            <span class="p">)</span> <span class="o">&gt;</span> <span class="n">stickiness</span><span class="p">:</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a>                <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">old_x</span><span class="p">,</span> <span class="n">old_y</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a>        <span class="c1"># Set the walker to be a city</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="n">old_x</span><span class="p">,</span> <span class="n">old_y</span><span class="p">]</span> <span class="o">=</span> <span class="n">STRUCTURE</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a>    <span class="k">def</span> <span class="nf">update_random_walk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stickiness</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Spawns a particle on a radius and calculates its next coordinate randomly.</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a><span class="sd">        Places a settlement once the particle encounters an established structure.</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a><span class="sd">        :param stickiness: The stickiness of the model. Between 0 and 1</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a>        <span class="k">assert</span> <span class="n">stickiness</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">stickiness</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Stickiness must be between 0 and 1&quot;</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a>        <span class="c1"># Calculate radius (increases logarithmically as structure grows)</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a>        <span class="n">radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">growing_radius</span><span class="p">()</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a>        <span class="c1"># Set the walker to be a particle at a random point on the edge of a</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a>        <span class="c1"># circle</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a>        <span class="n">angle</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a>        <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">))</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a>        <span class="n">y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">))</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a>        <span class="n">old_x</span><span class="p">,</span> <span class="n">old_y</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a>        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="o">==</span> <span class="n">NO_STRUCTURE</span><span class="p">:</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a>            <span class="n">old_x</span><span class="p">,</span> <span class="n">old_y</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a>            <span class="c1"># Move the walker</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a>            <span class="n">direction</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a>            <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a>                <span class="n">x</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>            <span class="k">elif</span> <span class="n">direction</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a>                <span class="n">x</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a>            <span class="k">elif</span> <span class="n">direction</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a>                <span class="n">y</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a>                <span class="n">y</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>            <span class="c1"># Check if the walker is within bounds</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a>            <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a>            <span class="k">elif</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">:</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a>            <span class="k">if</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a>                <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a>            <span class="k">elif</span> <span class="n">y</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">:</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a>                <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="o">!=</span> <span class="n">NO_STRUCTURE</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a>            <span class="p">)</span> <span class="o">&gt;</span> <span class="n">stickiness</span><span class="p">:</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a>                <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">old_x</span><span class="p">,</span> <span class="n">old_y</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="n">old_x</span><span class="p">,</span> <span class="n">old_y</span><span class="p">]</span> <span class="o">=</span> <span class="n">STRUCTURE</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a>    <span class="k">def</span> <span class="nf">get_box_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper function for calculating the fractal dimension using the box counting method.</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a><span class="sd">        Calculates and returns N, where N is the number of boxes that contain a developed part</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a><span class="sd">        of the city and s is the size of each box.</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a><span class="sd">        :param s: The size of each box</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a><span class="sd">        :return: N, the number of developed cells.</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a>        <span class="c1"># Assert that the argument n_boxes is valid</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a>        <span class="k">assert</span> <span class="n">s</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Number of boxes must be positive&quot;</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="s2">&quot;Number of boxes must be an integer&quot;</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a>        <span class="c1"># The size of each box</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a>        <span class="n">box_size</span> <span class="o">=</span> <span class="n">s</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a>        <span class="n">n_boxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">//</span> <span class="n">s</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a>        <span class="c1"># The number of boxes that contain a city</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a>        <span class="n">n_filled_boxes</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a>        <span class="c1"># Loop over all boxes</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_boxes</span><span class="p">):</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_boxes</span><span class="p">):</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a>                <span class="c1"># Check if the box contains a city</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a>                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a>                        <span class="n">i</span> <span class="o">*</span> <span class="n">box_size</span><span class="p">:</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">box_size</span><span class="p">,</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a>                        <span class="n">j</span> <span class="o">*</span> <span class="n">box_size</span><span class="p">:</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">box_size</span><span class="p">,</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a>                    <span class="p">]</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a>                    <span class="o">==</span> <span class="n">STRUCTURE</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a>                <span class="p">):</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a>                    <span class="n">n_filled_boxes</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a>        <span class="c1"># Calculate the fractal dimension</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a>        <span class="k">return</span> <span class="n">n_filled_boxes</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a>    <span class="k">def</span> <span class="nf">get_fractal_dim</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates the fractal dimension using the box counting method.</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a><span class="sd">        This method divides the grid into n_boxes*n_boxes boxes and counts the number of boxes that contain a city.</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a><span class="sd">        The result can be used to calculate the fractal dimension using the following formula:</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a><span class="sd">        N(s)*s^D = C (Mandelbrot 1983)</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a><span class="sd">        We estimate slope D to equation Log(N(s)) = Log(C) + Dlog(1/s) + error [1]</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a><span class="sd">        where N is the number of boxes that contain a city, s is the size of each box, and D is the fractal dimension.</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a><span class="sd">        [1] Guoqiang Shen, &quot;Fractal dimension and fractal growth of urbanized areas&quot;</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a><span class="sd">        :return: The fractal dimension</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a>        <span class="c1"># store for different box sizes</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a>        <span class="n">log_N</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a>        <span class="n">log_1_over_s</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a>        <span class="c1"># Collect data for different box sizes</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a>        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)):</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a>            <span class="n">N</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_box_count</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a>            <span class="n">log_N</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a>            <span class="n">log_1_over_s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">s</span><span class="p">))</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a>        <span class="k">def</span> <span class="nf">line_to_fit</span><span class="p">(</span><span class="n">log_1_over_s</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">):</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a>            <span class="k">return</span> <span class="n">C</span> <span class="o">+</span> <span class="n">D</span> <span class="o">*</span> <span class="n">log_1_over_s</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a>        <span class="c1"># Fit a line over the data to get slope D i.e. the fractal dimension</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a>        <span class="n">params</span><span class="p">,</span> <span class="n">cov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">line_to_fit</span><span class="p">,</span> <span class="n">log_1_over_s</span><span class="p">,</span> <span class="n">log_N</span><span class="p">)</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos">514</span></a>        <span class="n">_</span><span class="p">,</span> <span class="n">D_fit</span> <span class="o">=</span> <span class="n">params</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos">515</span></a>
</span><span id="L-516"><a href="#L-516"><span class="linenos">516</span></a>        <span class="k">return</span> <span class="n">D_fit</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos">517</span></a>
</span><span id="L-518"><a href="#L-518"><span class="linenos">518</span></a>    <span class="k">def</span> <span class="nf">density_gradient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buffer_size</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos">519</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates the density gradient of the city.</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos">520</span></a>
</span><span id="L-521"><a href="#L-521"><span class="linenos">521</span></a><span class="sd">        The density gradient is calculated by dividing the city into rings of increasing radius and calculating the density of each ring.</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos">522</span></a><span class="sd">        The density of a ring is the number of developed cells in the ring divided by the number of cells in the ring.</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos">523</span></a>
</span><span id="L-524"><a href="#L-524"><span class="linenos">524</span></a><span class="sd">        :param buffer_size: The size of the buffer between rings</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos">525</span></a><span class="sd">        :return: The distances and densities of the rings</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos">526</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos">527</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">buffer_size</span><span class="p">:</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos">528</span></a>            <span class="n">buffer_size</span> <span class="o">=</span> <span class="n">DEFAULT_BUFFER_SIZE</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos">529</span></a>        <span class="n">center</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos">530</span></a>        <span class="n">distances</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos">531</span></a>        <span class="n">densities</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos">532</span></a>        <span class="k">for</span> <span class="n">radius</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">buffer_size</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">buffer_size</span><span class="p">):</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos">533</span></a>            <span class="c1"># define the outer circle of the current ring</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos">534</span></a>            <span class="n">outer_mask</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos">535</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">fromfunction</span><span class="p">(</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos">536</span></a>                    <span class="k">lambda</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos">537</span></a>                        <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">center</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">j</span> <span class="o">-</span> <span class="n">center</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">),</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos">538</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos">539</span></a>                <span class="p">)</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos">540</span></a>                <span class="o">&lt;</span> <span class="n">radius</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos">541</span></a>            <span class="p">)</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos">542</span></a>            <span class="c1"># define the inner circle of the current ring</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos">543</span></a>            <span class="n">inner_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfunction</span><span class="p">(</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos">544</span></a>                <span class="k">lambda</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">i</span> <span class="o">-</span> <span class="n">center</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">j</span> <span class="o">-</span> <span class="n">center</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">),</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos">545</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos">546</span></a>            <span class="p">)</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">radius</span> <span class="o">-</span> <span class="n">buffer_size</span><span class="p">)</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos">547</span></a>            <span class="c1"># the difference between the outer and inner masks</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos">548</span></a>            <span class="n">ring_mask</span> <span class="o">=</span> <span class="n">outer_mask</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">inner_mask</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos">549</span></a>
</span><span id="L-550"><a href="#L-550"><span class="linenos">550</span></a>            <span class="c1"># calculate the number of cells and number of developed cells in</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos">551</span></a>            <span class="c1"># the ring</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos">552</span></a>            <span class="n">ring_cells</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ring_mask</span><span class="p">)</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos">553</span></a>            <span class="n">developed_cells</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="n">ring_mask</span><span class="p">]</span> <span class="o">==</span> <span class="n">STRUCTURE</span><span class="p">)</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos">554</span></a>
</span><span id="L-555"><a href="#L-555"><span class="linenos">555</span></a>            <span class="c1"># calculate density of the ring</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos">556</span></a>            <span class="n">ring_density</span> <span class="o">=</span> <span class="n">developed_cells</span> <span class="o">/</span> <span class="n">ring_cells</span> <span class="k">if</span> <span class="n">ring_cells</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos">557</span></a>
</span><span id="L-558"><a href="#L-558"><span class="linenos">558</span></a>            <span class="k">if</span> <span class="n">ring_density</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">radius</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">:</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos">559</span></a>                <span class="k">break</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos">560</span></a>
</span><span id="L-561"><a href="#L-561"><span class="linenos">561</span></a>            <span class="n">densities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ring_density</span><span class="p">)</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos">562</span></a>            <span class="n">distances</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos">563</span></a>                <span class="n">radius</span> <span class="o">-</span> <span class="n">buffer_size</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos">564</span></a>            <span class="p">)</span>  <span class="c1"># use the midpoint of the ring as the distance</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos">565</span></a>
</span><span id="L-566"><a href="#L-566"><span class="linenos">566</span></a>        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos">567</span></a>            <span class="n">densities</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos">568</span></a>        <span class="p">),</span> <span class="s2">&quot;Length of distances and densities must be equal&quot;</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos">569</span></a>        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">),</span> <span class="s2">&quot;Distances must be positive&quot;</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos">570</span></a>        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">densities</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">),</span> <span class="s2">&quot;Densities must be positive&quot;</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos">571</span></a>        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">distances</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">distances</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos">572</span></a>                      <span class="p">),</span> <span class="s2">&quot;Distances must be sorted&quot;</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos">573</span></a>
</span><span id="L-574"><a href="#L-574"><span class="linenos">574</span></a>        <span class="k">return</span> <span class="n">distances</span><span class="p">,</span> <span class="n">densities</span>
</span></pre></div>


            </section>
                <section id="DEBUG">
                    <div class="attr variable">
            <span class="name">DEBUG</span>        =
<span class="default_value">False</span>

        
    </div>
    <a class="headerlink" href="#DEBUG"></a>
    
    

                </section>
                <section id="NO_STRUCTURE">
                    <div class="attr variable">
            <span class="name">NO_STRUCTURE</span>        =
<span class="default_value">0</span>

        
    </div>
    <a class="headerlink" href="#NO_STRUCTURE"></a>
    
    

                </section>
                <section id="STRUCTURE">
                    <div class="attr variable">
            <span class="name">STRUCTURE</span>        =
<span class="default_value">2</span>

        
    </div>
    <a class="headerlink" href="#STRUCTURE"></a>
    
    

                </section>
                <section id="DEFAULT_BUFFER_SIZE">
                    <div class="attr variable">
            <span class="name">DEFAULT_BUFFER_SIZE</span>        =
<span class="default_value">5</span>

        
    </div>
    <a class="headerlink" href="#DEFAULT_BUFFER_SIZE"></a>
    
    

                </section>
                <section id="R_SCALING_FACTOR">
                    <div class="attr variable">
            <span class="name">R_SCALING_FACTOR</span>        =
<span class="default_value">20</span>

        
    </div>
    <a class="headerlink" href="#R_SCALING_FACTOR"></a>
    
    

                </section>
                <section id="FOCAL_ATTRACTION">
                    <div class="attr variable">
            <span class="name">FOCAL_ATTRACTION</span>        =
<span class="default_value">0.2</span>

        
    </div>
    <a class="headerlink" href="#FOCAL_ATTRACTION"></a>
    
    

                </section>
                <section id="DIRECTIONAL_DRIFT">
                    <div class="attr variable">
            <span class="name">DIRECTIONAL_DRIFT</span>        =
<span class="default_value">0.2</span>

        
    </div>
    <a class="headerlink" href="#DIRECTIONAL_DRIFT"></a>
    
    

                </section>
                <section id="DIRECTIONS">
                    <div class="attr variable">
            <span class="name">DIRECTIONS</span>        =
<input id="DIRECTIONS-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="DIRECTIONS-view-value"></label><span class="default_value">array([[ 0,  1],
       [ 1,  1],
       [ 1,  0],
       [ 1, -1],
       [ 0, -1],
       [-1, -1],
       [-1,  0],
       [-1,  1]])</span>

        
    </div>
    <a class="headerlink" href="#DIRECTIONS"></a>
    
    

                </section>
                <section id="LEN_DIRECTIONS">
                    <div class="attr variable">
            <span class="name">LEN_DIRECTIONS</span>        =
<span class="default_value">8</span>

        
    </div>
    <a class="headerlink" href="#LEN_DIRECTIONS"></a>
    
    

                </section>
                <section id="my_random_function">
                            <input id="my_random_function-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">my_random_function</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">collection</span>, </span><span class="param"><span class="n">p</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="my_random_function-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#my_random_function"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="my_random_function-42"><a href="#my_random_function-42"><span class="linenos">42</span></a><span class="k">def</span> <span class="nf">my_random_function</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
</span><span id="my_random_function-43"><a href="#my_random_function-43"><span class="linenos">43</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Choose a random element from a collection based on the given probabilities.</span>
</span><span id="my_random_function-44"><a href="#my_random_function-44"><span class="linenos">44</span></a>
</span><span id="my_random_function-45"><a href="#my_random_function-45"><span class="linenos">45</span></a><span class="sd">    Faster than np.random.choice for small collections.</span>
</span><span id="my_random_function-46"><a href="#my_random_function-46"><span class="linenos">46</span></a><span class="sd">    Based on: https://stackoverflow.com/questions/18622781/why-is-numpy-random-choice-so-slow</span>
</span><span id="my_random_function-47"><a href="#my_random_function-47"><span class="linenos">47</span></a>
</span><span id="my_random_function-48"><a href="#my_random_function-48"><span class="linenos">48</span></a><span class="sd">    :param collection: The collection to choose from</span>
</span><span id="my_random_function-49"><a href="#my_random_function-49"><span class="linenos">49</span></a><span class="sd">    :param p: The probabilities of choosing each element</span>
</span><span id="my_random_function-50"><a href="#my_random_function-50"><span class="linenos">50</span></a><span class="sd">    :return: The chosen element</span>
</span><span id="my_random_function-51"><a href="#my_random_function-51"><span class="linenos">51</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="my_random_function-52"><a href="#my_random_function-52"><span class="linenos">52</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="my_random_function-53"><a href="#my_random_function-53"><span class="linenos">53</span></a>        <span class="n">collection</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">collection</span><span class="p">))</span>
</span><span id="my_random_function-54"><a href="#my_random_function-54"><span class="linenos">54</span></a>    <span class="n">miles</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="my_random_function-55"><a href="#my_random_function-55"><span class="linenos">55</span></a>    <span class="n">current</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="my_random_function-56"><a href="#my_random_function-56"><span class="linenos">56</span></a>    <span class="k">for</span> <span class="n">prob</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
</span><span id="my_random_function-57"><a href="#my_random_function-57"><span class="linenos">57</span></a>        <span class="n">miles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>
</span><span id="my_random_function-58"><a href="#my_random_function-58"><span class="linenos">58</span></a>        <span class="n">current</span> <span class="o">+=</span> <span class="n">prob</span>
</span><span id="my_random_function-59"><a href="#my_random_function-59"><span class="linenos">59</span></a>
</span><span id="my_random_function-60"><a href="#my_random_function-60"><span class="linenos">60</span></a>    <span class="k">assert</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;Probabilities must sum to 1&quot;</span>
</span><span id="my_random_function-61"><a href="#my_random_function-61"><span class="linenos">61</span></a>
</span><span id="my_random_function-62"><a href="#my_random_function-62"><span class="linenos">62</span></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
</span><span id="my_random_function-63"><a href="#my_random_function-63"><span class="linenos">63</span></a>    <span class="n">_all</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">miles</span><span class="p">))</span>
</span><span id="my_random_function-64"><a href="#my_random_function-64"><span class="linenos">64</span></a>    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">_all</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="my_random_function-65"><a href="#my_random_function-65"><span class="linenos">65</span></a>        <span class="k">if</span> <span class="n">_all</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">_all</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">x</span><span class="p">:</span>
</span><span id="my_random_function-66"><a href="#my_random_function-66"><span class="linenos">66</span></a>            <span class="n">_all</span> <span class="o">=</span> <span class="n">_all</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">_all</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">:]</span>
</span><span id="my_random_function-67"><a href="#my_random_function-67"><span class="linenos">67</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="my_random_function-68"><a href="#my_random_function-68"><span class="linenos">68</span></a>            <span class="n">_all</span> <span class="o">=</span> <span class="n">_all</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">_all</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">]</span>
</span><span id="my_random_function-69"><a href="#my_random_function-69"><span class="linenos">69</span></a>    <span class="k">return</span> <span class="n">_all</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Choose a random element from a collection based on the given probabilities.</p>

<p>Faster than np.random.choice for small collections.
Based on: <a href="https://stackoverflow.com/questions/18622781/why-is-numpy-random-choice-so-slow">https://stackoverflow.com/questions/18622781/why-is-numpy-random-choice-so-slow</a></p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>collection</strong>:  The collection to choose from</li>
<li><strong>p</strong>:  The probabilities of choosing each element</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>The chosen element</p>
</blockquote>
</div>


                </section>
                <section id="assert_if_debug">
                            <input id="assert_if_debug-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">assert_if_debug</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">condition</span><span class="p">:</span> <span class="nb">bool</span>, </span><span class="param"><span class="n">message</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="assert_if_debug-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#assert_if_debug"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="assert_if_debug-72"><a href="#assert_if_debug-72"><span class="linenos">72</span></a><span class="k">def</span> <span class="nf">assert_if_debug</span><span class="p">(</span><span class="n">condition</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="assert_if_debug-73"><a href="#assert_if_debug-73"><span class="linenos">73</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Assert that the condition is true if the program is in debug mode.</span>
</span><span id="assert_if_debug-74"><a href="#assert_if_debug-74"><span class="linenos">74</span></a>
</span><span id="assert_if_debug-75"><a href="#assert_if_debug-75"><span class="linenos">75</span></a><span class="sd">    :param condition: The condition to check</span>
</span><span id="assert_if_debug-76"><a href="#assert_if_debug-76"><span class="linenos">76</span></a><span class="sd">    :param message: The message to display if the condition is false</span>
</span><span id="assert_if_debug-77"><a href="#assert_if_debug-77"><span class="linenos">77</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="assert_if_debug-78"><a href="#assert_if_debug-78"><span class="linenos">78</span></a>    <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span>
</span><span id="assert_if_debug-79"><a href="#assert_if_debug-79"><span class="linenos">79</span></a>        <span class="k">assert</span> <span class="nb">eval</span><span class="p">(</span><span class="n">condition</span><span class="p">),</span> <span class="n">message</span>
</span></pre></div>


            <div class="docstring"><p>Assert that the condition is true if the program is in debug mode.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>condition</strong>:  The condition to check</li>
<li><strong>message</strong>:  The message to display if the condition is false</li>
</ul>
</div>


                </section>
                <section id="is_numeric">
                            <input id="is_numeric-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">is_numeric</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">obj</span><span class="p">:</span> <span class="nb">object</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="is_numeric-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#is_numeric"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="is_numeric-82"><a href="#is_numeric-82"><span class="linenos">82</span></a><span class="k">def</span> <span class="nf">is_numeric</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="is_numeric-83"><a href="#is_numeric-83"><span class="linenos">83</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if the object is numeric.</span>
</span><span id="is_numeric-84"><a href="#is_numeric-84"><span class="linenos">84</span></a>
</span><span id="is_numeric-85"><a href="#is_numeric-85"><span class="linenos">85</span></a><span class="sd">    :param obj: The object to check</span>
</span><span id="is_numeric-86"><a href="#is_numeric-86"><span class="linenos">86</span></a><span class="sd">    :return: Whether the object is numeric</span>
</span><span id="is_numeric-87"><a href="#is_numeric-87"><span class="linenos">87</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="is_numeric-88"><a href="#is_numeric-88"><span class="linenos">88</span></a>    <span class="n">attrs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;__add__&quot;</span><span class="p">,</span> <span class="s2">&quot;__sub__&quot;</span><span class="p">,</span> <span class="s2">&quot;__mul__&quot;</span><span class="p">,</span> <span class="s2">&quot;__truediv__&quot;</span><span class="p">,</span> <span class="s2">&quot;__pow__&quot;</span><span class="p">]</span>
</span><span id="is_numeric-89"><a href="#is_numeric-89"><span class="linenos">89</span></a>    <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span> <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Check if the object is numeric.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>obj</strong>:  The object to check</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>Whether the object is numeric</p>
</blockquote>
</div>


                </section>
                <section id="Model">
                            <input id="Model-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Model</span>:

                <label class="view-source-button" for="Model-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Model"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Model-92"><a href="#Model-92"><span class="linenos"> 92</span></a><span class="k">class</span> <span class="nc">Model</span><span class="p">:</span>
</span><span id="Model-93"><a href="#Model-93"><span class="linenos"> 93</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;This class represents the model of the city.</span>
</span><span id="Model-94"><a href="#Model-94"><span class="linenos"> 94</span></a><span class="sd">    It contains the grid and the methods modify it, as well as different calculations for the model.</span>
</span><span id="Model-95"><a href="#Model-95"><span class="linenos"> 95</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Model-96"><a href="#Model-96"><span class="linenos"> 96</span></a>
</span><span id="Model-97"><a href="#Model-97"><span class="linenos"> 97</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="Model-98"><a href="#Model-98"><span class="linenos"> 98</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Model-99"><a href="#Model-99"><span class="linenos"> 99</span></a>        <span class="n">w</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
</span><span id="Model-100"><a href="#Model-100"><span class="linenos">100</span></a>        <span class="n">h</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
</span><span id="Model-101"><a href="#Model-101"><span class="linenos">101</span></a>        <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;multiple&quot;</span><span class="p">,</span>
</span><span id="Model-102"><a href="#Model-102"><span class="linenos">102</span></a>        <span class="n">particle_generation</span><span class="o">=</span><span class="s2">&quot;on_radius&quot;</span><span class="p">,</span>
</span><span id="Model-103"><a href="#Model-103"><span class="linenos">103</span></a>        <span class="n">seed</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="Model-104"><a href="#Model-104"><span class="linenos">104</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Model-105"><a href="#Model-105"><span class="linenos">105</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the model with a grid of size w*h.</span>
</span><span id="Model-106"><a href="#Model-106"><span class="linenos">106</span></a>
</span><span id="Model-107"><a href="#Model-107"><span class="linenos">107</span></a><span class="sd">        :param w: The width of the grid</span>
</span><span id="Model-108"><a href="#Model-108"><span class="linenos">108</span></a><span class="sd">        :param h: The height of the grid</span>
</span><span id="Model-109"><a href="#Model-109"><span class="linenos">109</span></a><span class="sd">        :param mode: The mode of the model. Either &#39;single&#39; or &#39;multiple&#39;</span>
</span><span id="Model-110"><a href="#Model-110"><span class="linenos">110</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Model-111"><a href="#Model-111"><span class="linenos">111</span></a>        <span class="k">assert</span> <span class="n">mode</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="Model-112"><a href="#Model-112"><span class="linenos">112</span></a>            <span class="s2">&quot;single&quot;</span><span class="p">,</span>
</span><span id="Model-113"><a href="#Model-113"><span class="linenos">113</span></a>            <span class="s2">&quot;multiple&quot;</span><span class="p">,</span>
</span><span id="Model-114"><a href="#Model-114"><span class="linenos">114</span></a>        <span class="p">],</span> <span class="s2">&quot;Mode must be either &#39;single&#39; or &#39;multiple&#39;&quot;</span>
</span><span id="Model-115"><a href="#Model-115"><span class="linenos">115</span></a>        <span class="k">assert</span> <span class="n">w</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">h</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Width and height must be positive&quot;</span>
</span><span id="Model-116"><a href="#Model-116"><span class="linenos">116</span></a>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span>
</span><span id="Model-117"><a href="#Model-117"><span class="linenos">117</span></a>            <span class="n">w</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span>
</span><span id="Model-118"><a href="#Model-118"><span class="linenos">118</span></a>            <span class="n">h</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="s2">&quot;Width and height must be integers&quot;</span>
</span><span id="Model-119"><a href="#Model-119"><span class="linenos">119</span></a>
</span><span id="Model-120"><a href="#Model-120"><span class="linenos">120</span></a>        <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
</span><span id="Model-121"><a href="#Model-121"><span class="linenos">121</span></a>        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
</span><span id="Model-122"><a href="#Model-122"><span class="linenos">122</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
</span><span id="Model-123"><a href="#Model-123"><span class="linenos">123</span></a>
</span><span id="Model-124"><a href="#Model-124"><span class="linenos">124</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="n">w</span>
</span><span id="Model-125"><a href="#Model-125"><span class="linenos">125</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="n">h</span>
</span><span id="Model-126"><a href="#Model-126"><span class="linenos">126</span></a>
</span><span id="Model-127"><a href="#Model-127"><span class="linenos">127</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">))</span>
</span><span id="Model-128"><a href="#Model-128"><span class="linenos">128</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span>
</span><span id="Model-129"><a href="#Model-129"><span class="linenos">129</span></a>
</span><span id="Model-130"><a href="#Model-130"><span class="linenos">130</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">direction_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
</span><span id="Model-131"><a href="#Model-131"><span class="linenos">131</span></a>
</span><span id="Model-132"><a href="#Model-132"><span class="linenos">132</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;single&quot;</span><span class="p">:</span>
</span><span id="Model-133"><a href="#Model-133"><span class="linenos">133</span></a>            <span class="c1"># Set the center of the grid to be a city</span>
</span><span id="Model-134"><a href="#Model-134"><span class="linenos">134</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">//</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">STRUCTURE</span>
</span><span id="Model-135"><a href="#Model-135"><span class="linenos">135</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;multiple&quot;</span><span class="p">:</span>
</span><span id="Model-136"><a href="#Model-136"><span class="linenos">136</span></a>            <span class="c1"># Place two centers for each settlement</span>
</span><span id="Model-137"><a href="#Model-137"><span class="linenos">137</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">//</span> <span class="mi">7</span><span class="p">),</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">//</span> <span class="mi">7</span><span class="p">)]</span> <span class="o">=</span> <span class="n">STRUCTURE</span>
</span><span id="Model-138"><a href="#Model-138"><span class="linenos">138</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">//</span> <span class="mi">7</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">//</span> <span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">STRUCTURE</span>
</span><span id="Model-139"><a href="#Model-139"><span class="linenos">139</span></a>
</span><span id="Model-140"><a href="#Model-140"><span class="linenos">140</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">particle_generation</span> <span class="o">=</span> <span class="n">particle_generation</span>
</span><span id="Model-141"><a href="#Model-141"><span class="linenos">141</span></a>
</span><span id="Model-142"><a href="#Model-142"><span class="linenos">142</span></a>        <span class="n">assert_if_debug</span><span class="p">(</span>
</span><span id="Model-143"><a href="#Model-143"><span class="linenos">143</span></a>            <span class="s2">&quot;np.count_nonzero(self.grid) &gt;= 1&quot;</span><span class="p">,</span>
</span><span id="Model-144"><a href="#Model-144"><span class="linenos">144</span></a>            <span class="s2">&quot;There should be at least one city at the start&quot;</span><span class="p">,</span>
</span><span id="Model-145"><a href="#Model-145"><span class="linenos">145</span></a>        <span class="p">)</span>
</span><span id="Model-146"><a href="#Model-146"><span class="linenos">146</span></a>
</span><span id="Model-147"><a href="#Model-147"><span class="linenos">147</span></a>    <span class="k">def</span> <span class="nf">loop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">stickiness</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Model-148"><a href="#Model-148"><span class="linenos">148</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Run the model for `n&#39; iterations.</span>
</span><span id="Model-149"><a href="#Model-149"><span class="linenos">149</span></a>
</span><span id="Model-150"><a href="#Model-150"><span class="linenos">150</span></a><span class="sd">        :param n: The number of iterations to run the model for</span>
</span><span id="Model-151"><a href="#Model-151"><span class="linenos">151</span></a><span class="sd">        :param stickiness: The stickiness of the model. Between 0 and 1</span>
</span><span id="Model-152"><a href="#Model-152"><span class="linenos">152</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Model-153"><a href="#Model-153"><span class="linenos">153</span></a>        <span class="c1"># Assert that the argument n is valid</span>
</span><span id="Model-154"><a href="#Model-154"><span class="linenos">154</span></a>        <span class="k">assert</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Number of iterations must be positive&quot;</span>
</span><span id="Model-155"><a href="#Model-155"><span class="linenos">155</span></a>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="s2">&quot;Number of iterations must be an integer&quot;</span>
</span><span id="Model-156"><a href="#Model-156"><span class="linenos">156</span></a>
</span><span id="Model-157"><a href="#Model-157"><span class="linenos">157</span></a>        <span class="c1"># Assert that the argument stickiness is valid</span>
</span><span id="Model-158"><a href="#Model-158"><span class="linenos">158</span></a>        <span class="k">assert</span> <span class="n">stickiness</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">stickiness</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Stickiness must be between 0 and 1&quot;</span>
</span><span id="Model-159"><a href="#Model-159"><span class="linenos">159</span></a>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stickiness</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span> <span class="s2">&quot;Stickiness must be a float&quot;</span>
</span><span id="Model-160"><a href="#Model-160"><span class="linenos">160</span></a>
</span><span id="Model-161"><a href="#Model-161"><span class="linenos">161</span></a>        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</span><span id="Model-162"><a href="#Model-162"><span class="linenos">162</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">stickiness</span><span class="p">)</span>
</span><span id="Model-163"><a href="#Model-163"><span class="linenos">163</span></a>
</span><span id="Model-164"><a href="#Model-164"><span class="linenos">164</span></a>    <span class="k">def</span> <span class="nf">focal_attraction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">normalized_vector_to_center</span><span class="p">):</span>
</span><span id="Model-165"><a href="#Model-165"><span class="linenos">165</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Given normalized vector from current position to the center, this function</span>
</span><span id="Model-166"><a href="#Model-166"><span class="linenos">166</span></a><span class="sd">        assigns probabilites to the directions of next move. Directions to the center</span>
</span><span id="Model-167"><a href="#Model-167"><span class="linenos">167</span></a><span class="sd">        are more likely due to focal attraction property.</span>
</span><span id="Model-168"><a href="#Model-168"><span class="linenos">168</span></a>
</span><span id="Model-169"><a href="#Model-169"><span class="linenos">169</span></a><span class="sd">        :param normalized_vector_to_center: The normalized vector from the current position to the center</span>
</span><span id="Model-170"><a href="#Model-170"><span class="linenos">170</span></a><span class="sd">        :return: The probabilities of the next move</span>
</span><span id="Model-171"><a href="#Model-171"><span class="linenos">171</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Model-172"><a href="#Model-172"><span class="linenos">172</span></a>
</span><span id="Model-173"><a href="#Model-173"><span class="linenos">173</span></a>        <span class="c1"># Assert that the argument normalized_vector_to_center is valid</span>
</span><span id="Model-174"><a href="#Model-174"><span class="linenos">174</span></a>        <span class="k">assert</span> <span class="n">normalized_vector_to_center</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span>
</span><span id="Model-175"><a href="#Model-175"><span class="linenos">175</span></a>            <span class="mi">2</span><span class="p">,),</span> <span class="s2">&quot;Vector must be 2-dimensional&quot;</span>
</span><span id="Model-176"><a href="#Model-176"><span class="linenos">176</span></a>        <span class="n">assert_if_debug</span><span class="p">(</span>
</span><span id="Model-177"><a href="#Model-177"><span class="linenos">177</span></a>            <span class="s2">&quot;np.isclose(np.linalg.norm(normalized_vector_to_center), 1)&quot;</span><span class="p">,</span>
</span><span id="Model-178"><a href="#Model-178"><span class="linenos">178</span></a>            <span class="s2">&quot;Vector must be normalized&quot;</span><span class="p">,</span>
</span><span id="Model-179"><a href="#Model-179"><span class="linenos">179</span></a>        <span class="p">)</span>
</span><span id="Model-180"><a href="#Model-180"><span class="linenos">180</span></a>
</span><span id="Model-181"><a href="#Model-181"><span class="linenos">181</span></a>        <span class="c1"># Calculate dot products to see which direction most aligns with the</span>
</span><span id="Model-182"><a href="#Model-182"><span class="linenos">182</span></a>        <span class="c1"># vector</span>
</span><span id="Model-183"><a href="#Model-183"><span class="linenos">183</span></a>        <span class="n">dot_prods</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">DIRECTIONS</span><span class="p">,</span> <span class="n">normalized_vector_to_center</span><span class="p">)</span>
</span><span id="Model-184"><a href="#Model-184"><span class="linenos">184</span></a>        <span class="c1"># Remove negative values</span>
</span><span id="Model-185"><a href="#Model-185"><span class="linenos">185</span></a>        <span class="n">positive_dot_prods</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">dot_prods</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="Model-186"><a href="#Model-186"><span class="linenos">186</span></a>
</span><span id="Model-187"><a href="#Model-187"><span class="linenos">187</span></a>        <span class="c1"># Calculate probabilities (based on focal attraction)</span>
</span><span id="Model-188"><a href="#Model-188"><span class="linenos">188</span></a>        <span class="n">uniform_probs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">LEN_DIRECTIONS</span><span class="p">)</span> <span class="o">/</span> <span class="n">LEN_DIRECTIONS</span>
</span><span id="Model-189"><a href="#Model-189"><span class="linenos">189</span></a>        <span class="n">normalized_dot_prods</span> <span class="o">=</span> <span class="n">positive_dot_prods</span> <span class="o">/</span> <span class="n">positive_dot_prods</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span><span id="Model-190"><a href="#Model-190"><span class="linenos">190</span></a>        <span class="n">probabilities_focal_attraction</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">FOCAL_ATTRACTION</span><span class="p">)</span> <span class="o">*</span> <span class="n">uniform_probs</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span>
</span><span id="Model-191"><a href="#Model-191"><span class="linenos">191</span></a>            <span class="n">FOCAL_ATTRACTION</span> <span class="o">*</span> <span class="n">normalized_dot_prods</span>
</span><span id="Model-192"><a href="#Model-192"><span class="linenos">192</span></a>        <span class="p">)</span>
</span><span id="Model-193"><a href="#Model-193"><span class="linenos">193</span></a>
</span><span id="Model-194"><a href="#Model-194"><span class="linenos">194</span></a>        <span class="c1"># Assert that probabilities sum to 1</span>
</span><span id="Model-195"><a href="#Model-195"><span class="linenos">195</span></a>        <span class="n">assert_if_debug</span><span class="p">(</span>
</span><span id="Model-196"><a href="#Model-196"><span class="linenos">196</span></a>            <span class="s2">&quot;np.isclose(probabilities_focal_attraction.sum(), 1)&quot;</span><span class="p">,</span>
</span><span id="Model-197"><a href="#Model-197"><span class="linenos">197</span></a>            <span class="s2">&quot;Probabilities must sum to 1&quot;</span><span class="p">,</span>
</span><span id="Model-198"><a href="#Model-198"><span class="linenos">198</span></a>        <span class="p">)</span>
</span><span id="Model-199"><a href="#Model-199"><span class="linenos">199</span></a>
</span><span id="Model-200"><a href="#Model-200"><span class="linenos">200</span></a>        <span class="k">return</span> <span class="n">probabilities_focal_attraction</span>
</span><span id="Model-201"><a href="#Model-201"><span class="linenos">201</span></a>
</span><span id="Model-202"><a href="#Model-202"><span class="linenos">202</span></a>    <span class="k">def</span> <span class="nf">directional_drift</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Model-203"><a href="#Model-203"><span class="linenos">203</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Given the previous direction, this function assigns probabilites</span>
</span><span id="Model-204"><a href="#Model-204"><span class="linenos">204</span></a><span class="sd">        to the directions of next move. Directions forward (with respect to the</span>
</span><span id="Model-205"><a href="#Model-205"><span class="linenos">205</span></a><span class="sd">        previous direction) are more likely due to directional drift.</span>
</span><span id="Model-206"><a href="#Model-206"><span class="linenos">206</span></a>
</span><span id="Model-207"><a href="#Model-207"><span class="linenos">207</span></a><span class="sd">        :return: The probabilities of the next move</span>
</span><span id="Model-208"><a href="#Model-208"><span class="linenos">208</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Model-209"><a href="#Model-209"><span class="linenos">209</span></a>
</span><span id="Model-210"><a href="#Model-210"><span class="linenos">210</span></a>        <span class="c1"># Calculate probabilities (based on directional drift)</span>
</span><span id="Model-211"><a href="#Model-211"><span class="linenos">211</span></a>        <span class="n">uniform_probs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">LEN_DIRECTIONS</span><span class="p">)</span> <span class="o">/</span> <span class="n">LEN_DIRECTIONS</span>
</span><span id="Model-212"><a href="#Model-212"><span class="linenos">212</span></a>        <span class="n">max_directional_drift_probs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">LEN_DIRECTIONS</span><span class="p">)</span>
</span><span id="Model-213"><a href="#Model-213"><span class="linenos">213</span></a>        <span class="n">max_directional_drift_probs</span><span class="p">[</span>
</span><span id="Model-214"><a href="#Model-214"><span class="linenos">214</span></a>            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">direction_index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">LEN_DIRECTIONS</span>
</span><span id="Model-215"><a href="#Model-215"><span class="linenos">215</span></a>        <span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
</span><span id="Model-216"><a href="#Model-216"><span class="linenos">216</span></a>            <span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span>
</span><span id="Model-217"><a href="#Model-217"><span class="linenos">217</span></a>        <span class="p">)</span>  <span class="c1"># Previous element</span>
</span><span id="Model-218"><a href="#Model-218"><span class="linenos">218</span></a>        <span class="n">max_directional_drift_probs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">direction_index</span> <span class="o">%</span> <span class="n">LEN_DIRECTIONS</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
</span><span id="Model-219"><a href="#Model-219"><span class="linenos">219</span></a>            <span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span>
</span><span id="Model-220"><a href="#Model-220"><span class="linenos">220</span></a>        <span class="p">)</span>  <span class="c1"># Current element</span>
</span><span id="Model-221"><a href="#Model-221"><span class="linenos">221</span></a>        <span class="n">max_directional_drift_probs</span><span class="p">[</span>
</span><span id="Model-222"><a href="#Model-222"><span class="linenos">222</span></a>            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">direction_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">LEN_DIRECTIONS</span>
</span><span id="Model-223"><a href="#Model-223"><span class="linenos">223</span></a>        <span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
</span><span id="Model-224"><a href="#Model-224"><span class="linenos">224</span></a>            <span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span>
</span><span id="Model-225"><a href="#Model-225"><span class="linenos">225</span></a>        <span class="p">)</span>  <span class="c1"># Next element</span>
</span><span id="Model-226"><a href="#Model-226"><span class="linenos">226</span></a>        <span class="n">probabilities_directional_drift</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">DIRECTIONAL_DRIFT</span><span class="p">)</span> <span class="o">*</span> <span class="n">uniform_probs</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span>
</span><span id="Model-227"><a href="#Model-227"><span class="linenos">227</span></a>            <span class="n">DIRECTIONAL_DRIFT</span> <span class="o">*</span> <span class="n">max_directional_drift_probs</span>
</span><span id="Model-228"><a href="#Model-228"><span class="linenos">228</span></a>        <span class="p">)</span>
</span><span id="Model-229"><a href="#Model-229"><span class="linenos">229</span></a>
</span><span id="Model-230"><a href="#Model-230"><span class="linenos">230</span></a>        <span class="c1"># Assert that probabilities sum to 1</span>
</span><span id="Model-231"><a href="#Model-231"><span class="linenos">231</span></a>        <span class="n">assert_if_debug</span><span class="p">(</span>
</span><span id="Model-232"><a href="#Model-232"><span class="linenos">232</span></a>            <span class="s2">&quot;np.isclose(probabilities_directional_drift.sum(), 1)&quot;</span><span class="p">,</span>
</span><span id="Model-233"><a href="#Model-233"><span class="linenos">233</span></a>            <span class="s2">&quot;Probabilities must sum to 1&quot;</span><span class="p">,</span>
</span><span id="Model-234"><a href="#Model-234"><span class="linenos">234</span></a>        <span class="p">)</span>
</span><span id="Model-235"><a href="#Model-235"><span class="linenos">235</span></a>        <span class="k">return</span> <span class="n">probabilities_directional_drift</span>
</span><span id="Model-236"><a href="#Model-236"><span class="linenos">236</span></a>
</span><span id="Model-237"><a href="#Model-237"><span class="linenos">237</span></a>    <span class="k">def</span> <span class="nf">growing_radius</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Model-238"><a href="#Model-238"><span class="linenos">238</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates the radius where the particles appear. This radius</span>
</span><span id="Model-239"><a href="#Model-239"><span class="linenos">239</span></a><span class="sd">        grows logarithmically as a function of structure size</span>
</span><span id="Model-240"><a href="#Model-240"><span class="linenos">240</span></a>
</span><span id="Model-241"><a href="#Model-241"><span class="linenos">241</span></a><span class="sd">        :return: The radius where the particles appear</span>
</span><span id="Model-242"><a href="#Model-242"><span class="linenos">242</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Model-243"><a href="#Model-243"><span class="linenos">243</span></a>        <span class="n">radius</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">R_SCALING_FACTOR</span>
</span><span id="Model-244"><a href="#Model-244"><span class="linenos">244</span></a>
</span><span id="Model-245"><a href="#Model-245"><span class="linenos">245</span></a>        <span class="k">assert</span> <span class="n">radius</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Radius must be positive, check R_SCALING_FACTOR.&quot;</span>
</span><span id="Model-246"><a href="#Model-246"><span class="linenos">246</span></a>
</span><span id="Model-247"><a href="#Model-247"><span class="linenos">247</span></a>        <span class="c1"># Return the radius if it is within bounds, otherwise return the</span>
</span><span id="Model-248"><a href="#Model-248"><span class="linenos">248</span></a>        <span class="c1"># maximum possible radius</span>
</span><span id="Model-249"><a href="#Model-249"><span class="linenos">249</span></a>        <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="Model-250"><a href="#Model-250"><span class="linenos">250</span></a>
</span><span id="Model-251"><a href="#Model-251"><span class="linenos">251</span></a>    <span class="k">def</span> <span class="nf">norm_vector_to_center</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">center_x</span><span class="p">,</span> <span class="n">center_y</span><span class="p">):</span>
</span><span id="Model-252"><a href="#Model-252"><span class="linenos">252</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Takes coordinates of current position and coordinates of some</span>
</span><span id="Model-253"><a href="#Model-253"><span class="linenos">253</span></a><span class="sd">        center (settlement). Returns a normalized vector to that center.</span>
</span><span id="Model-254"><a href="#Model-254"><span class="linenos">254</span></a>
</span><span id="Model-255"><a href="#Model-255"><span class="linenos">255</span></a><span class="sd">        :param x: The x-coordinate of the current position</span>
</span><span id="Model-256"><a href="#Model-256"><span class="linenos">256</span></a><span class="sd">        :param y: The y-coordinate of the current position</span>
</span><span id="Model-257"><a href="#Model-257"><span class="linenos">257</span></a><span class="sd">        :param center_x: The x-coordinate of the center</span>
</span><span id="Model-258"><a href="#Model-258"><span class="linenos">258</span></a><span class="sd">        :param center_y: The y-coordinate of the center</span>
</span><span id="Model-259"><a href="#Model-259"><span class="linenos">259</span></a><span class="sd">        :return: The normalized vector to the center</span>
</span><span id="Model-260"><a href="#Model-260"><span class="linenos">260</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Model-261"><a href="#Model-261"><span class="linenos">261</span></a>
</span><span id="Model-262"><a href="#Model-262"><span class="linenos">262</span></a>        <span class="c1"># Assert that the arguments are valid</span>
</span><span id="Model-263"><a href="#Model-263"><span class="linenos">263</span></a>        <span class="k">assert</span> <span class="p">(</span>
</span><span id="Model-264"><a href="#Model-264"><span class="linenos">264</span></a>            <span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span>
</span><span id="Model-265"><a href="#Model-265"><span class="linenos">265</span></a>        <span class="p">),</span> <span class="s2">&quot;Current position must be within bounds&quot;</span>
</span><span id="Model-266"><a href="#Model-266"><span class="linenos">266</span></a>        <span class="k">assert</span> <span class="p">(</span>
</span><span id="Model-267"><a href="#Model-267"><span class="linenos">267</span></a>            <span class="n">center_x</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">center_x</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="ow">and</span> <span class="n">center_y</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">center_y</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span>
</span><span id="Model-268"><a href="#Model-268"><span class="linenos">268</span></a>        <span class="p">),</span> <span class="s2">&quot;Center must be within bounds&quot;</span>
</span><span id="Model-269"><a href="#Model-269"><span class="linenos">269</span></a>
</span><span id="Model-270"><a href="#Model-270"><span class="linenos">270</span></a>        <span class="c1"># Get vector pointing to the center from current position</span>
</span><span id="Model-271"><a href="#Model-271"><span class="linenos">271</span></a>        <span class="n">vector_to_center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">center_x</span> <span class="o">-</span> <span class="n">x</span><span class="p">,</span> <span class="n">center_y</span> <span class="o">-</span> <span class="n">y</span><span class="p">])</span>
</span><span id="Model-272"><a href="#Model-272"><span class="linenos">272</span></a>
</span><span id="Model-273"><a href="#Model-273"><span class="linenos">273</span></a>        <span class="c1"># Get the norm of the vector, but faster than numpy :)</span>
</span><span id="Model-274"><a href="#Model-274"><span class="linenos">274</span></a>        <span class="n">norm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">center_x</span><span class="p">,</span> <span class="n">center_y</span><span class="p">)</span>
</span><span id="Model-275"><a href="#Model-275"><span class="linenos">275</span></a>
</span><span id="Model-276"><a href="#Model-276"><span class="linenos">276</span></a>        <span class="c1"># Normalize vector</span>
</span><span id="Model-277"><a href="#Model-277"><span class="linenos">277</span></a>        <span class="k">if</span> <span class="n">norm</span><span class="p">:</span>
</span><span id="Model-278"><a href="#Model-278"><span class="linenos">278</span></a>            <span class="n">normalized_vector_to_center</span> <span class="o">=</span> <span class="n">vector_to_center</span> <span class="o">/</span> <span class="n">norm</span>
</span><span id="Model-279"><a href="#Model-279"><span class="linenos">279</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Model-280"><a href="#Model-280"><span class="linenos">280</span></a>            <span class="n">normalized_vector_to_center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
</span><span id="Model-281"><a href="#Model-281"><span class="linenos">281</span></a>
</span><span id="Model-282"><a href="#Model-282"><span class="linenos">282</span></a>        <span class="k">return</span> <span class="n">normalized_vector_to_center</span>
</span><span id="Model-283"><a href="#Model-283"><span class="linenos">283</span></a>
</span><span id="Model-284"><a href="#Model-284"><span class="linenos">284</span></a>    <span class="k">def</span> <span class="nf">distance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">):</span>
</span><span id="Model-285"><a href="#Model-285"><span class="linenos">285</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates distance between two coordinates.</span>
</span><span id="Model-286"><a href="#Model-286"><span class="linenos">286</span></a>
</span><span id="Model-287"><a href="#Model-287"><span class="linenos">287</span></a><span class="sd">        :param x1: The x-coordinate of the first point</span>
</span><span id="Model-288"><a href="#Model-288"><span class="linenos">288</span></a><span class="sd">        :param y1: The y-coordinate of the first point</span>
</span><span id="Model-289"><a href="#Model-289"><span class="linenos">289</span></a><span class="sd">        :param x2: The x-coordinate of the second point</span>
</span><span id="Model-290"><a href="#Model-290"><span class="linenos">290</span></a><span class="sd">        :param y2: The y-coordinate of the second point</span>
</span><span id="Model-291"><a href="#Model-291"><span class="linenos">291</span></a><span class="sd">        :return: The distance between the two points</span>
</span><span id="Model-292"><a href="#Model-292"><span class="linenos">292</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Model-293"><a href="#Model-293"><span class="linenos">293</span></a>        <span class="n">assert_if_debug</span><span class="p">(</span>
</span><span id="Model-294"><a href="#Model-294"><span class="linenos">294</span></a>            <span class="s2">&quot;is_numeric(x1) and is_numeric(y1) and is_numeric(x2) and is_numeric(y2)&quot;</span><span class="p">,</span>
</span><span id="Model-295"><a href="#Model-295"><span class="linenos">295</span></a>            <span class="s2">&quot;Coordinates must be numeric&quot;</span><span class="p">,</span>
</span><span id="Model-296"><a href="#Model-296"><span class="linenos">296</span></a>        <span class="p">)</span>
</span><span id="Model-297"><a href="#Model-297"><span class="linenos">297</span></a>
</span><span id="Model-298"><a href="#Model-298"><span class="linenos">298</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="Model-299"><a href="#Model-299"><span class="linenos">299</span></a>
</span><span id="Model-300"><a href="#Model-300"><span class="linenos">300</span></a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stickiness</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
</span><span id="Model-301"><a href="#Model-301"><span class="linenos">301</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Spawns a particle and calculates its next coordinate, taking into account</span>
</span><span id="Model-302"><a href="#Model-302"><span class="linenos">302</span></a><span class="sd">        the directional drift and focal attraction. If multiple settlements are considered,</span>
</span><span id="Model-303"><a href="#Model-303"><span class="linenos">303</span></a><span class="sd">        the particle is more likely to head in the direction of the closer one.</span>
</span><span id="Model-304"><a href="#Model-304"><span class="linenos">304</span></a><span class="sd">        Places a settlement once the particle encounters an established structure.</span>
</span><span id="Model-305"><a href="#Model-305"><span class="linenos">305</span></a><span class="sd">        Stops if movement goes off the grid.</span>
</span><span id="Model-306"><a href="#Model-306"><span class="linenos">306</span></a>
</span><span id="Model-307"><a href="#Model-307"><span class="linenos">307</span></a><span class="sd">        :param stickiness: The stickiness of the model. Between 0 and 1</span>
</span><span id="Model-308"><a href="#Model-308"><span class="linenos">308</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Model-309"><a href="#Model-309"><span class="linenos">309</span></a>        <span class="k">assert</span> <span class="n">stickiness</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">stickiness</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Stickiness must be between 0 and 1&quot;</span>
</span><span id="Model-310"><a href="#Model-310"><span class="linenos">310</span></a>
</span><span id="Model-311"><a href="#Model-311"><span class="linenos">311</span></a>        <span class="c1"># Reset initial direction</span>
</span><span id="Model-312"><a href="#Model-312"><span class="linenos">312</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">direction_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
</span><span id="Model-313"><a href="#Model-313"><span class="linenos">313</span></a>
</span><span id="Model-314"><a href="#Model-314"><span class="linenos">314</span></a>        <span class="c1"># Set grid center coordinates</span>
</span><span id="Model-315"><a href="#Model-315"><span class="linenos">315</span></a>        <span class="n">center_x</span><span class="p">,</span> <span class="n">center_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="Model-316"><a href="#Model-316"><span class="linenos">316</span></a>
</span><span id="Model-317"><a href="#Model-317"><span class="linenos">317</span></a>        <span class="c1"># For multiple settlements define multiple center points</span>
</span><span id="Model-318"><a href="#Model-318"><span class="linenos">318</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;multiple&quot;</span><span class="p">:</span>
</span><span id="Model-319"><a href="#Model-319"><span class="linenos">319</span></a>            <span class="n">center1_x</span><span class="p">,</span> <span class="n">center1_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">//</span> <span class="mi">4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">//</span> <span class="mi">4</span>
</span><span id="Model-320"><a href="#Model-320"><span class="linenos">320</span></a>            <span class="n">center2_x</span><span class="p">,</span> <span class="n">center2_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">//</span> <span class="mi">4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">//</span> <span class="mi">4</span>
</span><span id="Model-321"><a href="#Model-321"><span class="linenos">321</span></a>            <span class="n">settlement_centers</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Model-322"><a href="#Model-322"><span class="linenos">322</span></a>                <span class="p">[</span><span class="n">center1_x</span><span class="p">,</span> <span class="n">center1_y</span><span class="p">],</span> <span class="p">[</span><span class="n">center2_x</span><span class="p">,</span> <span class="n">center2_y</span><span class="p">]]</span>
</span><span id="Model-323"><a href="#Model-323"><span class="linenos">323</span></a>
</span><span id="Model-324"><a href="#Model-324"><span class="linenos">324</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">particle_generation</span> <span class="o">==</span> <span class="s2">&quot;on_radius&quot;</span><span class="p">:</span>
</span><span id="Model-325"><a href="#Model-325"><span class="linenos">325</span></a>            <span class="c1"># Set growing radius</span>
</span><span id="Model-326"><a href="#Model-326"><span class="linenos">326</span></a>            <span class="n">radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">growing_radius</span><span class="p">()</span>
</span><span id="Model-327"><a href="#Model-327"><span class="linenos">327</span></a>
</span><span id="Model-328"><a href="#Model-328"><span class="linenos">328</span></a>            <span class="c1"># Set the walker to be a particle at a random point on the edge of</span>
</span><span id="Model-329"><a href="#Model-329"><span class="linenos">329</span></a>            <span class="c1"># a circle</span>
</span><span id="Model-330"><a href="#Model-330"><span class="linenos">330</span></a>            <span class="n">angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
</span><span id="Model-331"><a href="#Model-331"><span class="linenos">331</span></a>            <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">center_x</span> <span class="o">+</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">))</span>
</span><span id="Model-332"><a href="#Model-332"><span class="linenos">332</span></a>            <span class="n">y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">center_y</span> <span class="o">+</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">))</span>
</span><span id="Model-333"><a href="#Model-333"><span class="linenos">333</span></a>
</span><span id="Model-334"><a href="#Model-334"><span class="linenos">334</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">particle_generation</span> <span class="o">==</span> <span class="s2">&quot;anywhere&quot;</span><span class="p">:</span>
</span><span id="Model-335"><a href="#Model-335"><span class="linenos">335</span></a>            <span class="c1"># Spawn particle randomly</span>
</span><span id="Model-336"><a href="#Model-336"><span class="linenos">336</span></a>            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">)</span>
</span><span id="Model-337"><a href="#Model-337"><span class="linenos">337</span></a>            <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">)</span>
</span><span id="Model-338"><a href="#Model-338"><span class="linenos">338</span></a>
</span><span id="Model-339"><a href="#Model-339"><span class="linenos">339</span></a>        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="o">==</span> <span class="n">NO_STRUCTURE</span><span class="p">:</span>
</span><span id="Model-340"><a href="#Model-340"><span class="linenos">340</span></a>            <span class="n">old_x</span><span class="p">,</span> <span class="n">old_y</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
</span><span id="Model-341"><a href="#Model-341"><span class="linenos">341</span></a>
</span><span id="Model-342"><a href="#Model-342"><span class="linenos">342</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;single&quot;</span><span class="p">:</span>
</span><span id="Model-343"><a href="#Model-343"><span class="linenos">343</span></a>                <span class="n">normalized_vector_to_center</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm_vector_to_center</span><span class="p">(</span>
</span><span id="Model-344"><a href="#Model-344"><span class="linenos">344</span></a>                    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">center_x</span><span class="p">,</span> <span class="n">center_y</span>
</span><span id="Model-345"><a href="#Model-345"><span class="linenos">345</span></a>                <span class="p">)</span>
</span><span id="Model-346"><a href="#Model-346"><span class="linenos">346</span></a>
</span><span id="Model-347"><a href="#Model-347"><span class="linenos">347</span></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;multiple&quot;</span><span class="p">:</span>
</span><span id="Model-348"><a href="#Model-348"><span class="linenos">348</span></a>                <span class="c1"># Choose a city to go to by calculating probabilites based on</span>
</span><span id="Model-349"><a href="#Model-349"><span class="linenos">349</span></a>                <span class="c1"># which one is closest</span>
</span><span id="Model-350"><a href="#Model-350"><span class="linenos">350</span></a>                <span class="n">distances_to_settlements</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Model-351"><a href="#Model-351"><span class="linenos">351</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">center1_x</span><span class="p">,</span> <span class="n">center1_y</span><span class="p">),</span>
</span><span id="Model-352"><a href="#Model-352"><span class="linenos">352</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">center2_x</span><span class="p">,</span> <span class="n">center2_y</span><span class="p">),</span>
</span><span id="Model-353"><a href="#Model-353"><span class="linenos">353</span></a>                <span class="p">]</span>
</span><span id="Model-354"><a href="#Model-354"><span class="linenos">354</span></a>                <span class="n">city_choice_probabilities</span> <span class="o">=</span> <span class="n">distances_to_settlements</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span>
</span><span id="Model-355"><a href="#Model-355"><span class="linenos">355</span></a>                    <span class="n">distances_to_settlements</span>
</span><span id="Model-356"><a href="#Model-356"><span class="linenos">356</span></a>                <span class="p">)</span>
</span><span id="Model-357"><a href="#Model-357"><span class="linenos">357</span></a>
</span><span id="Model-358"><a href="#Model-358"><span class="linenos">358</span></a>                <span class="n">city_chosen_index</span> <span class="o">=</span> <span class="n">my_random_function</span><span class="p">(</span>
</span><span id="Model-359"><a href="#Model-359"><span class="linenos">359</span></a>                    <span class="nb">len</span><span class="p">(</span><span class="n">distances_to_settlements</span><span class="p">),</span> <span class="n">p</span><span class="o">=</span><span class="n">city_choice_probabilities</span>
</span><span id="Model-360"><a href="#Model-360"><span class="linenos">360</span></a>                <span class="p">)</span>
</span><span id="Model-361"><a href="#Model-361"><span class="linenos">361</span></a>
</span><span id="Model-362"><a href="#Model-362"><span class="linenos">362</span></a>                <span class="c1"># Get a normalized vector to chosen center</span>
</span><span id="Model-363"><a href="#Model-363"><span class="linenos">363</span></a>                <span class="n">center_x</span><span class="p">,</span> <span class="n">center_y</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Model-364"><a href="#Model-364"><span class="linenos">364</span></a>                    <span class="n">settlement_centers</span><span class="p">[</span><span class="n">city_chosen_index</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
</span><span id="Model-365"><a href="#Model-365"><span class="linenos">365</span></a>                    <span class="n">settlement_centers</span><span class="p">[</span><span class="n">city_chosen_index</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
</span><span id="Model-366"><a href="#Model-366"><span class="linenos">366</span></a>                <span class="p">)</span>
</span><span id="Model-367"><a href="#Model-367"><span class="linenos">367</span></a>                <span class="n">normalized_vector_to_center</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm_vector_to_center</span><span class="p">(</span>
</span><span id="Model-368"><a href="#Model-368"><span class="linenos">368</span></a>                    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">center_x</span><span class="p">,</span> <span class="n">center_y</span>
</span><span id="Model-369"><a href="#Model-369"><span class="linenos">369</span></a>                <span class="p">)</span>
</span><span id="Model-370"><a href="#Model-370"><span class="linenos">370</span></a>
</span><span id="Model-371"><a href="#Model-371"><span class="linenos">371</span></a>            <span class="c1"># Take into account directional drift and focal attraction</span>
</span><span id="Model-372"><a href="#Model-372"><span class="linenos">372</span></a>            <span class="n">probabilities_focal_attraction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">focal_attraction</span><span class="p">(</span>
</span><span id="Model-373"><a href="#Model-373"><span class="linenos">373</span></a>                <span class="n">normalized_vector_to_center</span>
</span><span id="Model-374"><a href="#Model-374"><span class="linenos">374</span></a>            <span class="p">)</span>
</span><span id="Model-375"><a href="#Model-375"><span class="linenos">375</span></a>            <span class="n">probabilities_directional_drift</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">directional_drift</span><span class="p">()</span>
</span><span id="Model-376"><a href="#Model-376"><span class="linenos">376</span></a>
</span><span id="Model-377"><a href="#Model-377"><span class="linenos">377</span></a>            <span class="c1"># Combine directional drift and focal attraction</span>
</span><span id="Model-378"><a href="#Model-378"><span class="linenos">378</span></a>            <span class="n">probabilities</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Model-379"><a href="#Model-379"><span class="linenos">379</span></a>                <span class="n">probabilities_focal_attraction</span> <span class="o">+</span> <span class="n">probabilities_directional_drift</span>
</span><span id="Model-380"><a href="#Model-380"><span class="linenos">380</span></a>            <span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="Model-381"><a href="#Model-381"><span class="linenos">381</span></a>
</span><span id="Model-382"><a href="#Model-382"><span class="linenos">382</span></a>            <span class="c1"># Choose direction and move</span>
</span><span id="Model-383"><a href="#Model-383"><span class="linenos">383</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">direction_index</span> <span class="o">=</span> <span class="n">my_random_function</span><span class="p">(</span>
</span><span id="Model-384"><a href="#Model-384"><span class="linenos">384</span></a>                <span class="n">LEN_DIRECTIONS</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">probabilities</span><span class="p">)</span>
</span><span id="Model-385"><a href="#Model-385"><span class="linenos">385</span></a>
</span><span id="Model-386"><a href="#Model-386"><span class="linenos">386</span></a>            <span class="n">direction</span> <span class="o">=</span> <span class="n">DIRECTIONS</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">direction_index</span><span class="p">]</span>
</span><span id="Model-387"><a href="#Model-387"><span class="linenos">387</span></a>            <span class="n">x</span> <span class="o">+=</span> <span class="n">direction</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Model-388"><a href="#Model-388"><span class="linenos">388</span></a>            <span class="n">y</span> <span class="o">+=</span> <span class="n">direction</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Model-389"><a href="#Model-389"><span class="linenos">389</span></a>
</span><span id="Model-390"><a href="#Model-390"><span class="linenos">390</span></a>            <span class="c1"># Check if the walker is within bounds</span>
</span><span id="Model-391"><a href="#Model-391"><span class="linenos">391</span></a>            <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="ow">or</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">y</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">:</span>
</span><span id="Model-392"><a href="#Model-392"><span class="linenos">392</span></a>                <span class="k">return</span>
</span><span id="Model-393"><a href="#Model-393"><span class="linenos">393</span></a>
</span><span id="Model-394"><a href="#Model-394"><span class="linenos">394</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="o">!=</span> <span class="n">NO_STRUCTURE</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span>
</span><span id="Model-395"><a href="#Model-395"><span class="linenos">395</span></a>            <span class="p">)</span> <span class="o">&gt;</span> <span class="n">stickiness</span><span class="p">:</span>
</span><span id="Model-396"><a href="#Model-396"><span class="linenos">396</span></a>                <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">old_x</span><span class="p">,</span> <span class="n">old_y</span>
</span><span id="Model-397"><a href="#Model-397"><span class="linenos">397</span></a>
</span><span id="Model-398"><a href="#Model-398"><span class="linenos">398</span></a>        <span class="c1"># Set the walker to be a city</span>
</span><span id="Model-399"><a href="#Model-399"><span class="linenos">399</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="n">old_x</span><span class="p">,</span> <span class="n">old_y</span><span class="p">]</span> <span class="o">=</span> <span class="n">STRUCTURE</span>
</span><span id="Model-400"><a href="#Model-400"><span class="linenos">400</span></a>
</span><span id="Model-401"><a href="#Model-401"><span class="linenos">401</span></a>    <span class="k">def</span> <span class="nf">update_random_walk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stickiness</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
</span><span id="Model-402"><a href="#Model-402"><span class="linenos">402</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Spawns a particle on a radius and calculates its next coordinate randomly.</span>
</span><span id="Model-403"><a href="#Model-403"><span class="linenos">403</span></a><span class="sd">        Places a settlement once the particle encounters an established structure.</span>
</span><span id="Model-404"><a href="#Model-404"><span class="linenos">404</span></a>
</span><span id="Model-405"><a href="#Model-405"><span class="linenos">405</span></a><span class="sd">        :param stickiness: The stickiness of the model. Between 0 and 1</span>
</span><span id="Model-406"><a href="#Model-406"><span class="linenos">406</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Model-407"><a href="#Model-407"><span class="linenos">407</span></a>        <span class="k">assert</span> <span class="n">stickiness</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">stickiness</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Stickiness must be between 0 and 1&quot;</span>
</span><span id="Model-408"><a href="#Model-408"><span class="linenos">408</span></a>
</span><span id="Model-409"><a href="#Model-409"><span class="linenos">409</span></a>        <span class="c1"># Calculate radius (increases logarithmically as structure grows)</span>
</span><span id="Model-410"><a href="#Model-410"><span class="linenos">410</span></a>        <span class="n">radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">growing_radius</span><span class="p">()</span>
</span><span id="Model-411"><a href="#Model-411"><span class="linenos">411</span></a>
</span><span id="Model-412"><a href="#Model-412"><span class="linenos">412</span></a>        <span class="c1"># Set the walker to be a particle at a random point on the edge of a</span>
</span><span id="Model-413"><a href="#Model-413"><span class="linenos">413</span></a>        <span class="c1"># circle</span>
</span><span id="Model-414"><a href="#Model-414"><span class="linenos">414</span></a>        <span class="n">angle</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
</span><span id="Model-415"><a href="#Model-415"><span class="linenos">415</span></a>
</span><span id="Model-416"><a href="#Model-416"><span class="linenos">416</span></a>        <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">))</span>
</span><span id="Model-417"><a href="#Model-417"><span class="linenos">417</span></a>        <span class="n">y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">))</span>
</span><span id="Model-418"><a href="#Model-418"><span class="linenos">418</span></a>
</span><span id="Model-419"><a href="#Model-419"><span class="linenos">419</span></a>        <span class="n">old_x</span><span class="p">,</span> <span class="n">old_y</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
</span><span id="Model-420"><a href="#Model-420"><span class="linenos">420</span></a>        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="o">==</span> <span class="n">NO_STRUCTURE</span><span class="p">:</span>
</span><span id="Model-421"><a href="#Model-421"><span class="linenos">421</span></a>            <span class="n">old_x</span><span class="p">,</span> <span class="n">old_y</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
</span><span id="Model-422"><a href="#Model-422"><span class="linenos">422</span></a>
</span><span id="Model-423"><a href="#Model-423"><span class="linenos">423</span></a>            <span class="c1"># Move the walker</span>
</span><span id="Model-424"><a href="#Model-424"><span class="linenos">424</span></a>            <span class="n">direction</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="Model-425"><a href="#Model-425"><span class="linenos">425</span></a>            <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Model-426"><a href="#Model-426"><span class="linenos">426</span></a>                <span class="n">x</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Model-427"><a href="#Model-427"><span class="linenos">427</span></a>            <span class="k">elif</span> <span class="n">direction</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Model-428"><a href="#Model-428"><span class="linenos">428</span></a>                <span class="n">x</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="Model-429"><a href="#Model-429"><span class="linenos">429</span></a>            <span class="k">elif</span> <span class="n">direction</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="Model-430"><a href="#Model-430"><span class="linenos">430</span></a>                <span class="n">y</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Model-431"><a href="#Model-431"><span class="linenos">431</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Model-432"><a href="#Model-432"><span class="linenos">432</span></a>                <span class="n">y</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="Model-433"><a href="#Model-433"><span class="linenos">433</span></a>
</span><span id="Model-434"><a href="#Model-434"><span class="linenos">434</span></a>            <span class="c1"># Check if the walker is within bounds</span>
</span><span id="Model-435"><a href="#Model-435"><span class="linenos">435</span></a>            <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Model-436"><a href="#Model-436"><span class="linenos">436</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Model-437"><a href="#Model-437"><span class="linenos">437</span></a>            <span class="k">elif</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">:</span>
</span><span id="Model-438"><a href="#Model-438"><span class="linenos">438</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="Model-439"><a href="#Model-439"><span class="linenos">439</span></a>
</span><span id="Model-440"><a href="#Model-440"><span class="linenos">440</span></a>            <span class="k">if</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Model-441"><a href="#Model-441"><span class="linenos">441</span></a>                <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Model-442"><a href="#Model-442"><span class="linenos">442</span></a>            <span class="k">elif</span> <span class="n">y</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">:</span>
</span><span id="Model-443"><a href="#Model-443"><span class="linenos">443</span></a>                <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="Model-444"><a href="#Model-444"><span class="linenos">444</span></a>
</span><span id="Model-445"><a href="#Model-445"><span class="linenos">445</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="o">!=</span> <span class="n">NO_STRUCTURE</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span>
</span><span id="Model-446"><a href="#Model-446"><span class="linenos">446</span></a>            <span class="p">)</span> <span class="o">&gt;</span> <span class="n">stickiness</span><span class="p">:</span>
</span><span id="Model-447"><a href="#Model-447"><span class="linenos">447</span></a>                <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">old_x</span><span class="p">,</span> <span class="n">old_y</span>
</span><span id="Model-448"><a href="#Model-448"><span class="linenos">448</span></a>
</span><span id="Model-449"><a href="#Model-449"><span class="linenos">449</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="n">old_x</span><span class="p">,</span> <span class="n">old_y</span><span class="p">]</span> <span class="o">=</span> <span class="n">STRUCTURE</span>
</span><span id="Model-450"><a href="#Model-450"><span class="linenos">450</span></a>
</span><span id="Model-451"><a href="#Model-451"><span class="linenos">451</span></a>    <span class="k">def</span> <span class="nf">get_box_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
</span><span id="Model-452"><a href="#Model-452"><span class="linenos">452</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper function for calculating the fractal dimension using the box counting method.</span>
</span><span id="Model-453"><a href="#Model-453"><span class="linenos">453</span></a><span class="sd">        Calculates and returns N, where N is the number of boxes that contain a developed part</span>
</span><span id="Model-454"><a href="#Model-454"><span class="linenos">454</span></a><span class="sd">        of the city and s is the size of each box.</span>
</span><span id="Model-455"><a href="#Model-455"><span class="linenos">455</span></a>
</span><span id="Model-456"><a href="#Model-456"><span class="linenos">456</span></a><span class="sd">        :param s: The size of each box</span>
</span><span id="Model-457"><a href="#Model-457"><span class="linenos">457</span></a><span class="sd">        :return: N, the number of developed cells.</span>
</span><span id="Model-458"><a href="#Model-458"><span class="linenos">458</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Model-459"><a href="#Model-459"><span class="linenos">459</span></a>
</span><span id="Model-460"><a href="#Model-460"><span class="linenos">460</span></a>        <span class="c1"># Assert that the argument n_boxes is valid</span>
</span><span id="Model-461"><a href="#Model-461"><span class="linenos">461</span></a>        <span class="k">assert</span> <span class="n">s</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Number of boxes must be positive&quot;</span>
</span><span id="Model-462"><a href="#Model-462"><span class="linenos">462</span></a>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="s2">&quot;Number of boxes must be an integer&quot;</span>
</span><span id="Model-463"><a href="#Model-463"><span class="linenos">463</span></a>
</span><span id="Model-464"><a href="#Model-464"><span class="linenos">464</span></a>        <span class="c1"># The size of each box</span>
</span><span id="Model-465"><a href="#Model-465"><span class="linenos">465</span></a>        <span class="n">box_size</span> <span class="o">=</span> <span class="n">s</span>
</span><span id="Model-466"><a href="#Model-466"><span class="linenos">466</span></a>        <span class="n">n_boxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">//</span> <span class="n">s</span>
</span><span id="Model-467"><a href="#Model-467"><span class="linenos">467</span></a>
</span><span id="Model-468"><a href="#Model-468"><span class="linenos">468</span></a>        <span class="c1"># The number of boxes that contain a city</span>
</span><span id="Model-469"><a href="#Model-469"><span class="linenos">469</span></a>        <span class="n">n_filled_boxes</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Model-470"><a href="#Model-470"><span class="linenos">470</span></a>
</span><span id="Model-471"><a href="#Model-471"><span class="linenos">471</span></a>        <span class="c1"># Loop over all boxes</span>
</span><span id="Model-472"><a href="#Model-472"><span class="linenos">472</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_boxes</span><span class="p">):</span>
</span><span id="Model-473"><a href="#Model-473"><span class="linenos">473</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_boxes</span><span class="p">):</span>
</span><span id="Model-474"><a href="#Model-474"><span class="linenos">474</span></a>                <span class="c1"># Check if the box contains a city</span>
</span><span id="Model-475"><a href="#Model-475"><span class="linenos">475</span></a>                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span>
</span><span id="Model-476"><a href="#Model-476"><span class="linenos">476</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span>
</span><span id="Model-477"><a href="#Model-477"><span class="linenos">477</span></a>                        <span class="n">i</span> <span class="o">*</span> <span class="n">box_size</span><span class="p">:</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">box_size</span><span class="p">,</span>
</span><span id="Model-478"><a href="#Model-478"><span class="linenos">478</span></a>                        <span class="n">j</span> <span class="o">*</span> <span class="n">box_size</span><span class="p">:</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">box_size</span><span class="p">,</span>
</span><span id="Model-479"><a href="#Model-479"><span class="linenos">479</span></a>                    <span class="p">]</span>
</span><span id="Model-480"><a href="#Model-480"><span class="linenos">480</span></a>                    <span class="o">==</span> <span class="n">STRUCTURE</span>
</span><span id="Model-481"><a href="#Model-481"><span class="linenos">481</span></a>                <span class="p">):</span>
</span><span id="Model-482"><a href="#Model-482"><span class="linenos">482</span></a>                    <span class="n">n_filled_boxes</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Model-483"><a href="#Model-483"><span class="linenos">483</span></a>
</span><span id="Model-484"><a href="#Model-484"><span class="linenos">484</span></a>        <span class="c1"># Calculate the fractal dimension</span>
</span><span id="Model-485"><a href="#Model-485"><span class="linenos">485</span></a>        <span class="k">return</span> <span class="n">n_filled_boxes</span>
</span><span id="Model-486"><a href="#Model-486"><span class="linenos">486</span></a>
</span><span id="Model-487"><a href="#Model-487"><span class="linenos">487</span></a>    <span class="k">def</span> <span class="nf">get_fractal_dim</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Model-488"><a href="#Model-488"><span class="linenos">488</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates the fractal dimension using the box counting method.</span>
</span><span id="Model-489"><a href="#Model-489"><span class="linenos">489</span></a>
</span><span id="Model-490"><a href="#Model-490"><span class="linenos">490</span></a><span class="sd">        This method divides the grid into n_boxes*n_boxes boxes and counts the number of boxes that contain a city.</span>
</span><span id="Model-491"><a href="#Model-491"><span class="linenos">491</span></a><span class="sd">        The result can be used to calculate the fractal dimension using the following formula:</span>
</span><span id="Model-492"><a href="#Model-492"><span class="linenos">492</span></a><span class="sd">        N(s)*s^D = C (Mandelbrot 1983)</span>
</span><span id="Model-493"><a href="#Model-493"><span class="linenos">493</span></a><span class="sd">        We estimate slope D to equation Log(N(s)) = Log(C) + Dlog(1/s) + error [1]</span>
</span><span id="Model-494"><a href="#Model-494"><span class="linenos">494</span></a><span class="sd">        where N is the number of boxes that contain a city, s is the size of each box, and D is the fractal dimension.</span>
</span><span id="Model-495"><a href="#Model-495"><span class="linenos">495</span></a>
</span><span id="Model-496"><a href="#Model-496"><span class="linenos">496</span></a><span class="sd">        [1] Guoqiang Shen, &quot;Fractal dimension and fractal growth of urbanized areas&quot;</span>
</span><span id="Model-497"><a href="#Model-497"><span class="linenos">497</span></a>
</span><span id="Model-498"><a href="#Model-498"><span class="linenos">498</span></a><span class="sd">        :return: The fractal dimension</span>
</span><span id="Model-499"><a href="#Model-499"><span class="linenos">499</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Model-500"><a href="#Model-500"><span class="linenos">500</span></a>        <span class="c1"># store for different box sizes</span>
</span><span id="Model-501"><a href="#Model-501"><span class="linenos">501</span></a>        <span class="n">log_N</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Model-502"><a href="#Model-502"><span class="linenos">502</span></a>        <span class="n">log_1_over_s</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Model-503"><a href="#Model-503"><span class="linenos">503</span></a>
</span><span id="Model-504"><a href="#Model-504"><span class="linenos">504</span></a>        <span class="c1"># Collect data for different box sizes</span>
</span><span id="Model-505"><a href="#Model-505"><span class="linenos">505</span></a>        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)):</span>
</span><span id="Model-506"><a href="#Model-506"><span class="linenos">506</span></a>            <span class="n">N</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_box_count</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</span><span id="Model-507"><a href="#Model-507"><span class="linenos">507</span></a>            <span class="n">log_N</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
</span><span id="Model-508"><a href="#Model-508"><span class="linenos">508</span></a>            <span class="n">log_1_over_s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">s</span><span class="p">))</span>
</span><span id="Model-509"><a href="#Model-509"><span class="linenos">509</span></a>
</span><span id="Model-510"><a href="#Model-510"><span class="linenos">510</span></a>        <span class="k">def</span> <span class="nf">line_to_fit</span><span class="p">(</span><span class="n">log_1_over_s</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">):</span>
</span><span id="Model-511"><a href="#Model-511"><span class="linenos">511</span></a>            <span class="k">return</span> <span class="n">C</span> <span class="o">+</span> <span class="n">D</span> <span class="o">*</span> <span class="n">log_1_over_s</span>
</span><span id="Model-512"><a href="#Model-512"><span class="linenos">512</span></a>
</span><span id="Model-513"><a href="#Model-513"><span class="linenos">513</span></a>        <span class="c1"># Fit a line over the data to get slope D i.e. the fractal dimension</span>
</span><span id="Model-514"><a href="#Model-514"><span class="linenos">514</span></a>        <span class="n">params</span><span class="p">,</span> <span class="n">cov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">line_to_fit</span><span class="p">,</span> <span class="n">log_1_over_s</span><span class="p">,</span> <span class="n">log_N</span><span class="p">)</span>
</span><span id="Model-515"><a href="#Model-515"><span class="linenos">515</span></a>        <span class="n">_</span><span class="p">,</span> <span class="n">D_fit</span> <span class="o">=</span> <span class="n">params</span>
</span><span id="Model-516"><a href="#Model-516"><span class="linenos">516</span></a>
</span><span id="Model-517"><a href="#Model-517"><span class="linenos">517</span></a>        <span class="k">return</span> <span class="n">D_fit</span>
</span><span id="Model-518"><a href="#Model-518"><span class="linenos">518</span></a>
</span><span id="Model-519"><a href="#Model-519"><span class="linenos">519</span></a>    <span class="k">def</span> <span class="nf">density_gradient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buffer_size</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Model-520"><a href="#Model-520"><span class="linenos">520</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates the density gradient of the city.</span>
</span><span id="Model-521"><a href="#Model-521"><span class="linenos">521</span></a>
</span><span id="Model-522"><a href="#Model-522"><span class="linenos">522</span></a><span class="sd">        The density gradient is calculated by dividing the city into rings of increasing radius and calculating the density of each ring.</span>
</span><span id="Model-523"><a href="#Model-523"><span class="linenos">523</span></a><span class="sd">        The density of a ring is the number of developed cells in the ring divided by the number of cells in the ring.</span>
</span><span id="Model-524"><a href="#Model-524"><span class="linenos">524</span></a>
</span><span id="Model-525"><a href="#Model-525"><span class="linenos">525</span></a><span class="sd">        :param buffer_size: The size of the buffer between rings</span>
</span><span id="Model-526"><a href="#Model-526"><span class="linenos">526</span></a><span class="sd">        :return: The distances and densities of the rings</span>
</span><span id="Model-527"><a href="#Model-527"><span class="linenos">527</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Model-528"><a href="#Model-528"><span class="linenos">528</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">buffer_size</span><span class="p">:</span>
</span><span id="Model-529"><a href="#Model-529"><span class="linenos">529</span></a>            <span class="n">buffer_size</span> <span class="o">=</span> <span class="n">DEFAULT_BUFFER_SIZE</span>
</span><span id="Model-530"><a href="#Model-530"><span class="linenos">530</span></a>        <span class="n">center</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="Model-531"><a href="#Model-531"><span class="linenos">531</span></a>        <span class="n">distances</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Model-532"><a href="#Model-532"><span class="linenos">532</span></a>        <span class="n">densities</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Model-533"><a href="#Model-533"><span class="linenos">533</span></a>        <span class="k">for</span> <span class="n">radius</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">buffer_size</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">buffer_size</span><span class="p">):</span>
</span><span id="Model-534"><a href="#Model-534"><span class="linenos">534</span></a>            <span class="c1"># define the outer circle of the current ring</span>
</span><span id="Model-535"><a href="#Model-535"><span class="linenos">535</span></a>            <span class="n">outer_mask</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Model-536"><a href="#Model-536"><span class="linenos">536</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">fromfunction</span><span class="p">(</span>
</span><span id="Model-537"><a href="#Model-537"><span class="linenos">537</span></a>                    <span class="k">lambda</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
</span><span id="Model-538"><a href="#Model-538"><span class="linenos">538</span></a>                        <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">center</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">j</span> <span class="o">-</span> <span class="n">center</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">),</span>
</span><span id="Model-539"><a href="#Model-539"><span class="linenos">539</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
</span><span id="Model-540"><a href="#Model-540"><span class="linenos">540</span></a>                <span class="p">)</span>
</span><span id="Model-541"><a href="#Model-541"><span class="linenos">541</span></a>                <span class="o">&lt;</span> <span class="n">radius</span>
</span><span id="Model-542"><a href="#Model-542"><span class="linenos">542</span></a>            <span class="p">)</span>
</span><span id="Model-543"><a href="#Model-543"><span class="linenos">543</span></a>            <span class="c1"># define the inner circle of the current ring</span>
</span><span id="Model-544"><a href="#Model-544"><span class="linenos">544</span></a>            <span class="n">inner_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfunction</span><span class="p">(</span>
</span><span id="Model-545"><a href="#Model-545"><span class="linenos">545</span></a>                <span class="k">lambda</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">i</span> <span class="o">-</span> <span class="n">center</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">j</span> <span class="o">-</span> <span class="n">center</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">),</span>
</span><span id="Model-546"><a href="#Model-546"><span class="linenos">546</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
</span><span id="Model-547"><a href="#Model-547"><span class="linenos">547</span></a>            <span class="p">)</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">radius</span> <span class="o">-</span> <span class="n">buffer_size</span><span class="p">)</span>
</span><span id="Model-548"><a href="#Model-548"><span class="linenos">548</span></a>            <span class="c1"># the difference between the outer and inner masks</span>
</span><span id="Model-549"><a href="#Model-549"><span class="linenos">549</span></a>            <span class="n">ring_mask</span> <span class="o">=</span> <span class="n">outer_mask</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">inner_mask</span>
</span><span id="Model-550"><a href="#Model-550"><span class="linenos">550</span></a>
</span><span id="Model-551"><a href="#Model-551"><span class="linenos">551</span></a>            <span class="c1"># calculate the number of cells and number of developed cells in</span>
</span><span id="Model-552"><a href="#Model-552"><span class="linenos">552</span></a>            <span class="c1"># the ring</span>
</span><span id="Model-553"><a href="#Model-553"><span class="linenos">553</span></a>            <span class="n">ring_cells</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ring_mask</span><span class="p">)</span>
</span><span id="Model-554"><a href="#Model-554"><span class="linenos">554</span></a>            <span class="n">developed_cells</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="n">ring_mask</span><span class="p">]</span> <span class="o">==</span> <span class="n">STRUCTURE</span><span class="p">)</span>
</span><span id="Model-555"><a href="#Model-555"><span class="linenos">555</span></a>
</span><span id="Model-556"><a href="#Model-556"><span class="linenos">556</span></a>            <span class="c1"># calculate density of the ring</span>
</span><span id="Model-557"><a href="#Model-557"><span class="linenos">557</span></a>            <span class="n">ring_density</span> <span class="o">=</span> <span class="n">developed_cells</span> <span class="o">/</span> <span class="n">ring_cells</span> <span class="k">if</span> <span class="n">ring_cells</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
</span><span id="Model-558"><a href="#Model-558"><span class="linenos">558</span></a>
</span><span id="Model-559"><a href="#Model-559"><span class="linenos">559</span></a>            <span class="k">if</span> <span class="n">ring_density</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">radius</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">:</span>
</span><span id="Model-560"><a href="#Model-560"><span class="linenos">560</span></a>                <span class="k">break</span>
</span><span id="Model-561"><a href="#Model-561"><span class="linenos">561</span></a>
</span><span id="Model-562"><a href="#Model-562"><span class="linenos">562</span></a>            <span class="n">densities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ring_density</span><span class="p">)</span>
</span><span id="Model-563"><a href="#Model-563"><span class="linenos">563</span></a>            <span class="n">distances</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="Model-564"><a href="#Model-564"><span class="linenos">564</span></a>                <span class="n">radius</span> <span class="o">-</span> <span class="n">buffer_size</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="Model-565"><a href="#Model-565"><span class="linenos">565</span></a>            <span class="p">)</span>  <span class="c1"># use the midpoint of the ring as the distance</span>
</span><span id="Model-566"><a href="#Model-566"><span class="linenos">566</span></a>
</span><span id="Model-567"><a href="#Model-567"><span class="linenos">567</span></a>        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span>
</span><span id="Model-568"><a href="#Model-568"><span class="linenos">568</span></a>            <span class="n">densities</span>
</span><span id="Model-569"><a href="#Model-569"><span class="linenos">569</span></a>        <span class="p">),</span> <span class="s2">&quot;Length of distances and densities must be equal&quot;</span>
</span><span id="Model-570"><a href="#Model-570"><span class="linenos">570</span></a>        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">),</span> <span class="s2">&quot;Distances must be positive&quot;</span>
</span><span id="Model-571"><a href="#Model-571"><span class="linenos">571</span></a>        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">densities</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">),</span> <span class="s2">&quot;Densities must be positive&quot;</span>
</span><span id="Model-572"><a href="#Model-572"><span class="linenos">572</span></a>        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">distances</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">distances</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="Model-573"><a href="#Model-573"><span class="linenos">573</span></a>                      <span class="p">),</span> <span class="s2">&quot;Distances must be sorted&quot;</span>
</span><span id="Model-574"><a href="#Model-574"><span class="linenos">574</span></a>
</span><span id="Model-575"><a href="#Model-575"><span class="linenos">575</span></a>        <span class="k">return</span> <span class="n">distances</span><span class="p">,</span> <span class="n">densities</span>
</span></pre></div>


            <div class="docstring"><p>This class represents the model of the city.
It contains the grid and the methods modify it, as well as different calculations for the model.</p>
</div>


                            <div id="Model.__init__" class="classattr">
                                        <input id="Model.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Model</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">w</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span>,</span><span class="param">	<span class="n">h</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span>,</span><span class="param">	<span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;multiple&#39;</span>,</span><span class="param">	<span class="n">particle_generation</span><span class="o">=</span><span class="s1">&#39;on_radius&#39;</span>,</span><span class="param">	<span class="n">seed</span><span class="o">=</span><span class="mi">1</span></span>)</span>

                <label class="view-source-button" for="Model.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Model.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Model.__init__-97"><a href="#Model.__init__-97"><span class="linenos"> 97</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="Model.__init__-98"><a href="#Model.__init__-98"><span class="linenos"> 98</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Model.__init__-99"><a href="#Model.__init__-99"><span class="linenos"> 99</span></a>        <span class="n">w</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
</span><span id="Model.__init__-100"><a href="#Model.__init__-100"><span class="linenos">100</span></a>        <span class="n">h</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
</span><span id="Model.__init__-101"><a href="#Model.__init__-101"><span class="linenos">101</span></a>        <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;multiple&quot;</span><span class="p">,</span>
</span><span id="Model.__init__-102"><a href="#Model.__init__-102"><span class="linenos">102</span></a>        <span class="n">particle_generation</span><span class="o">=</span><span class="s2">&quot;on_radius&quot;</span><span class="p">,</span>
</span><span id="Model.__init__-103"><a href="#Model.__init__-103"><span class="linenos">103</span></a>        <span class="n">seed</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="Model.__init__-104"><a href="#Model.__init__-104"><span class="linenos">104</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Model.__init__-105"><a href="#Model.__init__-105"><span class="linenos">105</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the model with a grid of size w*h.</span>
</span><span id="Model.__init__-106"><a href="#Model.__init__-106"><span class="linenos">106</span></a>
</span><span id="Model.__init__-107"><a href="#Model.__init__-107"><span class="linenos">107</span></a><span class="sd">        :param w: The width of the grid</span>
</span><span id="Model.__init__-108"><a href="#Model.__init__-108"><span class="linenos">108</span></a><span class="sd">        :param h: The height of the grid</span>
</span><span id="Model.__init__-109"><a href="#Model.__init__-109"><span class="linenos">109</span></a><span class="sd">        :param mode: The mode of the model. Either &#39;single&#39; or &#39;multiple&#39;</span>
</span><span id="Model.__init__-110"><a href="#Model.__init__-110"><span class="linenos">110</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Model.__init__-111"><a href="#Model.__init__-111"><span class="linenos">111</span></a>        <span class="k">assert</span> <span class="n">mode</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="Model.__init__-112"><a href="#Model.__init__-112"><span class="linenos">112</span></a>            <span class="s2">&quot;single&quot;</span><span class="p">,</span>
</span><span id="Model.__init__-113"><a href="#Model.__init__-113"><span class="linenos">113</span></a>            <span class="s2">&quot;multiple&quot;</span><span class="p">,</span>
</span><span id="Model.__init__-114"><a href="#Model.__init__-114"><span class="linenos">114</span></a>        <span class="p">],</span> <span class="s2">&quot;Mode must be either &#39;single&#39; or &#39;multiple&#39;&quot;</span>
</span><span id="Model.__init__-115"><a href="#Model.__init__-115"><span class="linenos">115</span></a>        <span class="k">assert</span> <span class="n">w</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">h</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Width and height must be positive&quot;</span>
</span><span id="Model.__init__-116"><a href="#Model.__init__-116"><span class="linenos">116</span></a>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span>
</span><span id="Model.__init__-117"><a href="#Model.__init__-117"><span class="linenos">117</span></a>            <span class="n">w</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span>
</span><span id="Model.__init__-118"><a href="#Model.__init__-118"><span class="linenos">118</span></a>            <span class="n">h</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="s2">&quot;Width and height must be integers&quot;</span>
</span><span id="Model.__init__-119"><a href="#Model.__init__-119"><span class="linenos">119</span></a>
</span><span id="Model.__init__-120"><a href="#Model.__init__-120"><span class="linenos">120</span></a>        <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
</span><span id="Model.__init__-121"><a href="#Model.__init__-121"><span class="linenos">121</span></a>        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
</span><span id="Model.__init__-122"><a href="#Model.__init__-122"><span class="linenos">122</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
</span><span id="Model.__init__-123"><a href="#Model.__init__-123"><span class="linenos">123</span></a>
</span><span id="Model.__init__-124"><a href="#Model.__init__-124"><span class="linenos">124</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="n">w</span>
</span><span id="Model.__init__-125"><a href="#Model.__init__-125"><span class="linenos">125</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="n">h</span>
</span><span id="Model.__init__-126"><a href="#Model.__init__-126"><span class="linenos">126</span></a>
</span><span id="Model.__init__-127"><a href="#Model.__init__-127"><span class="linenos">127</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">))</span>
</span><span id="Model.__init__-128"><a href="#Model.__init__-128"><span class="linenos">128</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span>
</span><span id="Model.__init__-129"><a href="#Model.__init__-129"><span class="linenos">129</span></a>
</span><span id="Model.__init__-130"><a href="#Model.__init__-130"><span class="linenos">130</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">direction_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
</span><span id="Model.__init__-131"><a href="#Model.__init__-131"><span class="linenos">131</span></a>
</span><span id="Model.__init__-132"><a href="#Model.__init__-132"><span class="linenos">132</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;single&quot;</span><span class="p">:</span>
</span><span id="Model.__init__-133"><a href="#Model.__init__-133"><span class="linenos">133</span></a>            <span class="c1"># Set the center of the grid to be a city</span>
</span><span id="Model.__init__-134"><a href="#Model.__init__-134"><span class="linenos">134</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">//</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">STRUCTURE</span>
</span><span id="Model.__init__-135"><a href="#Model.__init__-135"><span class="linenos">135</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;multiple&quot;</span><span class="p">:</span>
</span><span id="Model.__init__-136"><a href="#Model.__init__-136"><span class="linenos">136</span></a>            <span class="c1"># Place two centers for each settlement</span>
</span><span id="Model.__init__-137"><a href="#Model.__init__-137"><span class="linenos">137</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">//</span> <span class="mi">7</span><span class="p">),</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">//</span> <span class="mi">7</span><span class="p">)]</span> <span class="o">=</span> <span class="n">STRUCTURE</span>
</span><span id="Model.__init__-138"><a href="#Model.__init__-138"><span class="linenos">138</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">//</span> <span class="mi">7</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">//</span> <span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">STRUCTURE</span>
</span><span id="Model.__init__-139"><a href="#Model.__init__-139"><span class="linenos">139</span></a>
</span><span id="Model.__init__-140"><a href="#Model.__init__-140"><span class="linenos">140</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">particle_generation</span> <span class="o">=</span> <span class="n">particle_generation</span>
</span><span id="Model.__init__-141"><a href="#Model.__init__-141"><span class="linenos">141</span></a>
</span><span id="Model.__init__-142"><a href="#Model.__init__-142"><span class="linenos">142</span></a>        <span class="n">assert_if_debug</span><span class="p">(</span>
</span><span id="Model.__init__-143"><a href="#Model.__init__-143"><span class="linenos">143</span></a>            <span class="s2">&quot;np.count_nonzero(self.grid) &gt;= 1&quot;</span><span class="p">,</span>
</span><span id="Model.__init__-144"><a href="#Model.__init__-144"><span class="linenos">144</span></a>            <span class="s2">&quot;There should be at least one city at the start&quot;</span><span class="p">,</span>
</span><span id="Model.__init__-145"><a href="#Model.__init__-145"><span class="linenos">145</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the model with a grid of size w*h.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>w</strong>:  The width of the grid</li>
<li><strong>h</strong>:  The height of the grid</li>
<li><strong>mode</strong>:  The mode of the model. Either 'single' or 'multiple'</li>
</ul>
</div>


                            </div>
                            <div id="Model.w" class="classattr">
                                <div class="attr variable">
            <span class="name">w</span>

        
    </div>
    <a class="headerlink" href="#Model.w"></a>
    
    

                            </div>
                            <div id="Model.h" class="classattr">
                                <div class="attr variable">
            <span class="name">h</span>

        
    </div>
    <a class="headerlink" href="#Model.h"></a>
    
    

                            </div>
                            <div id="Model.grid" class="classattr">
                                <div class="attr variable">
            <span class="name">grid</span>

        
    </div>
    <a class="headerlink" href="#Model.grid"></a>
    
    

                            </div>
                            <div id="Model.mode" class="classattr">
                                <div class="attr variable">
            <span class="name">mode</span>

        
    </div>
    <a class="headerlink" href="#Model.mode"></a>
    
    

                            </div>
                            <div id="Model.direction_index" class="classattr">
                                <div class="attr variable">
            <span class="name">direction_index</span>

        
    </div>
    <a class="headerlink" href="#Model.direction_index"></a>
    
    

                            </div>
                            <div id="Model.particle_generation" class="classattr">
                                <div class="attr variable">
            <span class="name">particle_generation</span>

        
    </div>
    <a class="headerlink" href="#Model.particle_generation"></a>
    
    

                            </div>
                            <div id="Model.loop" class="classattr">
                                        <input id="Model.loop-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">loop</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span>, </span><span class="param"><span class="n">stickiness</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Model.loop-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Model.loop"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Model.loop-147"><a href="#Model.loop-147"><span class="linenos">147</span></a>    <span class="k">def</span> <span class="nf">loop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">stickiness</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Model.loop-148"><a href="#Model.loop-148"><span class="linenos">148</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Run the model for `n&#39; iterations.</span>
</span><span id="Model.loop-149"><a href="#Model.loop-149"><span class="linenos">149</span></a>
</span><span id="Model.loop-150"><a href="#Model.loop-150"><span class="linenos">150</span></a><span class="sd">        :param n: The number of iterations to run the model for</span>
</span><span id="Model.loop-151"><a href="#Model.loop-151"><span class="linenos">151</span></a><span class="sd">        :param stickiness: The stickiness of the model. Between 0 and 1</span>
</span><span id="Model.loop-152"><a href="#Model.loop-152"><span class="linenos">152</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Model.loop-153"><a href="#Model.loop-153"><span class="linenos">153</span></a>        <span class="c1"># Assert that the argument n is valid</span>
</span><span id="Model.loop-154"><a href="#Model.loop-154"><span class="linenos">154</span></a>        <span class="k">assert</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Number of iterations must be positive&quot;</span>
</span><span id="Model.loop-155"><a href="#Model.loop-155"><span class="linenos">155</span></a>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="s2">&quot;Number of iterations must be an integer&quot;</span>
</span><span id="Model.loop-156"><a href="#Model.loop-156"><span class="linenos">156</span></a>
</span><span id="Model.loop-157"><a href="#Model.loop-157"><span class="linenos">157</span></a>        <span class="c1"># Assert that the argument stickiness is valid</span>
</span><span id="Model.loop-158"><a href="#Model.loop-158"><span class="linenos">158</span></a>        <span class="k">assert</span> <span class="n">stickiness</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">stickiness</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Stickiness must be between 0 and 1&quot;</span>
</span><span id="Model.loop-159"><a href="#Model.loop-159"><span class="linenos">159</span></a>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stickiness</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span> <span class="s2">&quot;Stickiness must be a float&quot;</span>
</span><span id="Model.loop-160"><a href="#Model.loop-160"><span class="linenos">160</span></a>
</span><span id="Model.loop-161"><a href="#Model.loop-161"><span class="linenos">161</span></a>        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</span><span id="Model.loop-162"><a href="#Model.loop-162"><span class="linenos">162</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">stickiness</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Run the model for `n' iterations.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>n</strong>:  The number of iterations to run the model for</li>
<li><strong>stickiness</strong>:  The stickiness of the model. Between 0 and 1</li>
</ul>
</div>


                            </div>
                            <div id="Model.focal_attraction" class="classattr">
                                        <input id="Model.focal_attraction-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">focal_attraction</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">normalized_vector_to_center</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Model.focal_attraction-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Model.focal_attraction"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Model.focal_attraction-164"><a href="#Model.focal_attraction-164"><span class="linenos">164</span></a>    <span class="k">def</span> <span class="nf">focal_attraction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">normalized_vector_to_center</span><span class="p">):</span>
</span><span id="Model.focal_attraction-165"><a href="#Model.focal_attraction-165"><span class="linenos">165</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Given normalized vector from current position to the center, this function</span>
</span><span id="Model.focal_attraction-166"><a href="#Model.focal_attraction-166"><span class="linenos">166</span></a><span class="sd">        assigns probabilites to the directions of next move. Directions to the center</span>
</span><span id="Model.focal_attraction-167"><a href="#Model.focal_attraction-167"><span class="linenos">167</span></a><span class="sd">        are more likely due to focal attraction property.</span>
</span><span id="Model.focal_attraction-168"><a href="#Model.focal_attraction-168"><span class="linenos">168</span></a>
</span><span id="Model.focal_attraction-169"><a href="#Model.focal_attraction-169"><span class="linenos">169</span></a><span class="sd">        :param normalized_vector_to_center: The normalized vector from the current position to the center</span>
</span><span id="Model.focal_attraction-170"><a href="#Model.focal_attraction-170"><span class="linenos">170</span></a><span class="sd">        :return: The probabilities of the next move</span>
</span><span id="Model.focal_attraction-171"><a href="#Model.focal_attraction-171"><span class="linenos">171</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Model.focal_attraction-172"><a href="#Model.focal_attraction-172"><span class="linenos">172</span></a>
</span><span id="Model.focal_attraction-173"><a href="#Model.focal_attraction-173"><span class="linenos">173</span></a>        <span class="c1"># Assert that the argument normalized_vector_to_center is valid</span>
</span><span id="Model.focal_attraction-174"><a href="#Model.focal_attraction-174"><span class="linenos">174</span></a>        <span class="k">assert</span> <span class="n">normalized_vector_to_center</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span>
</span><span id="Model.focal_attraction-175"><a href="#Model.focal_attraction-175"><span class="linenos">175</span></a>            <span class="mi">2</span><span class="p">,),</span> <span class="s2">&quot;Vector must be 2-dimensional&quot;</span>
</span><span id="Model.focal_attraction-176"><a href="#Model.focal_attraction-176"><span class="linenos">176</span></a>        <span class="n">assert_if_debug</span><span class="p">(</span>
</span><span id="Model.focal_attraction-177"><a href="#Model.focal_attraction-177"><span class="linenos">177</span></a>            <span class="s2">&quot;np.isclose(np.linalg.norm(normalized_vector_to_center), 1)&quot;</span><span class="p">,</span>
</span><span id="Model.focal_attraction-178"><a href="#Model.focal_attraction-178"><span class="linenos">178</span></a>            <span class="s2">&quot;Vector must be normalized&quot;</span><span class="p">,</span>
</span><span id="Model.focal_attraction-179"><a href="#Model.focal_attraction-179"><span class="linenos">179</span></a>        <span class="p">)</span>
</span><span id="Model.focal_attraction-180"><a href="#Model.focal_attraction-180"><span class="linenos">180</span></a>
</span><span id="Model.focal_attraction-181"><a href="#Model.focal_attraction-181"><span class="linenos">181</span></a>        <span class="c1"># Calculate dot products to see which direction most aligns with the</span>
</span><span id="Model.focal_attraction-182"><a href="#Model.focal_attraction-182"><span class="linenos">182</span></a>        <span class="c1"># vector</span>
</span><span id="Model.focal_attraction-183"><a href="#Model.focal_attraction-183"><span class="linenos">183</span></a>        <span class="n">dot_prods</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">DIRECTIONS</span><span class="p">,</span> <span class="n">normalized_vector_to_center</span><span class="p">)</span>
</span><span id="Model.focal_attraction-184"><a href="#Model.focal_attraction-184"><span class="linenos">184</span></a>        <span class="c1"># Remove negative values</span>
</span><span id="Model.focal_attraction-185"><a href="#Model.focal_attraction-185"><span class="linenos">185</span></a>        <span class="n">positive_dot_prods</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">dot_prods</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="Model.focal_attraction-186"><a href="#Model.focal_attraction-186"><span class="linenos">186</span></a>
</span><span id="Model.focal_attraction-187"><a href="#Model.focal_attraction-187"><span class="linenos">187</span></a>        <span class="c1"># Calculate probabilities (based on focal attraction)</span>
</span><span id="Model.focal_attraction-188"><a href="#Model.focal_attraction-188"><span class="linenos">188</span></a>        <span class="n">uniform_probs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">LEN_DIRECTIONS</span><span class="p">)</span> <span class="o">/</span> <span class="n">LEN_DIRECTIONS</span>
</span><span id="Model.focal_attraction-189"><a href="#Model.focal_attraction-189"><span class="linenos">189</span></a>        <span class="n">normalized_dot_prods</span> <span class="o">=</span> <span class="n">positive_dot_prods</span> <span class="o">/</span> <span class="n">positive_dot_prods</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span><span id="Model.focal_attraction-190"><a href="#Model.focal_attraction-190"><span class="linenos">190</span></a>        <span class="n">probabilities_focal_attraction</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">FOCAL_ATTRACTION</span><span class="p">)</span> <span class="o">*</span> <span class="n">uniform_probs</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span>
</span><span id="Model.focal_attraction-191"><a href="#Model.focal_attraction-191"><span class="linenos">191</span></a>            <span class="n">FOCAL_ATTRACTION</span> <span class="o">*</span> <span class="n">normalized_dot_prods</span>
</span><span id="Model.focal_attraction-192"><a href="#Model.focal_attraction-192"><span class="linenos">192</span></a>        <span class="p">)</span>
</span><span id="Model.focal_attraction-193"><a href="#Model.focal_attraction-193"><span class="linenos">193</span></a>
</span><span id="Model.focal_attraction-194"><a href="#Model.focal_attraction-194"><span class="linenos">194</span></a>        <span class="c1"># Assert that probabilities sum to 1</span>
</span><span id="Model.focal_attraction-195"><a href="#Model.focal_attraction-195"><span class="linenos">195</span></a>        <span class="n">assert_if_debug</span><span class="p">(</span>
</span><span id="Model.focal_attraction-196"><a href="#Model.focal_attraction-196"><span class="linenos">196</span></a>            <span class="s2">&quot;np.isclose(probabilities_focal_attraction.sum(), 1)&quot;</span><span class="p">,</span>
</span><span id="Model.focal_attraction-197"><a href="#Model.focal_attraction-197"><span class="linenos">197</span></a>            <span class="s2">&quot;Probabilities must sum to 1&quot;</span><span class="p">,</span>
</span><span id="Model.focal_attraction-198"><a href="#Model.focal_attraction-198"><span class="linenos">198</span></a>        <span class="p">)</span>
</span><span id="Model.focal_attraction-199"><a href="#Model.focal_attraction-199"><span class="linenos">199</span></a>
</span><span id="Model.focal_attraction-200"><a href="#Model.focal_attraction-200"><span class="linenos">200</span></a>        <span class="k">return</span> <span class="n">probabilities_focal_attraction</span>
</span></pre></div>


            <div class="docstring"><p>Given normalized vector from current position to the center, this function
assigns probabilites to the directions of next move. Directions to the center
are more likely due to focal attraction property.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>normalized_vector_to_center</strong>:  The normalized vector from the current position to the center</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>The probabilities of the next move</p>
</blockquote>
</div>


                            </div>
                            <div id="Model.directional_drift" class="classattr">
                                        <input id="Model.directional_drift-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">directional_drift</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Model.directional_drift-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Model.directional_drift"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Model.directional_drift-202"><a href="#Model.directional_drift-202"><span class="linenos">202</span></a>    <span class="k">def</span> <span class="nf">directional_drift</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Model.directional_drift-203"><a href="#Model.directional_drift-203"><span class="linenos">203</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Given the previous direction, this function assigns probabilites</span>
</span><span id="Model.directional_drift-204"><a href="#Model.directional_drift-204"><span class="linenos">204</span></a><span class="sd">        to the directions of next move. Directions forward (with respect to the</span>
</span><span id="Model.directional_drift-205"><a href="#Model.directional_drift-205"><span class="linenos">205</span></a><span class="sd">        previous direction) are more likely due to directional drift.</span>
</span><span id="Model.directional_drift-206"><a href="#Model.directional_drift-206"><span class="linenos">206</span></a>
</span><span id="Model.directional_drift-207"><a href="#Model.directional_drift-207"><span class="linenos">207</span></a><span class="sd">        :return: The probabilities of the next move</span>
</span><span id="Model.directional_drift-208"><a href="#Model.directional_drift-208"><span class="linenos">208</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Model.directional_drift-209"><a href="#Model.directional_drift-209"><span class="linenos">209</span></a>
</span><span id="Model.directional_drift-210"><a href="#Model.directional_drift-210"><span class="linenos">210</span></a>        <span class="c1"># Calculate probabilities (based on directional drift)</span>
</span><span id="Model.directional_drift-211"><a href="#Model.directional_drift-211"><span class="linenos">211</span></a>        <span class="n">uniform_probs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">LEN_DIRECTIONS</span><span class="p">)</span> <span class="o">/</span> <span class="n">LEN_DIRECTIONS</span>
</span><span id="Model.directional_drift-212"><a href="#Model.directional_drift-212"><span class="linenos">212</span></a>        <span class="n">max_directional_drift_probs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">LEN_DIRECTIONS</span><span class="p">)</span>
</span><span id="Model.directional_drift-213"><a href="#Model.directional_drift-213"><span class="linenos">213</span></a>        <span class="n">max_directional_drift_probs</span><span class="p">[</span>
</span><span id="Model.directional_drift-214"><a href="#Model.directional_drift-214"><span class="linenos">214</span></a>            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">direction_index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">LEN_DIRECTIONS</span>
</span><span id="Model.directional_drift-215"><a href="#Model.directional_drift-215"><span class="linenos">215</span></a>        <span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
</span><span id="Model.directional_drift-216"><a href="#Model.directional_drift-216"><span class="linenos">216</span></a>            <span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span>
</span><span id="Model.directional_drift-217"><a href="#Model.directional_drift-217"><span class="linenos">217</span></a>        <span class="p">)</span>  <span class="c1"># Previous element</span>
</span><span id="Model.directional_drift-218"><a href="#Model.directional_drift-218"><span class="linenos">218</span></a>        <span class="n">max_directional_drift_probs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">direction_index</span> <span class="o">%</span> <span class="n">LEN_DIRECTIONS</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
</span><span id="Model.directional_drift-219"><a href="#Model.directional_drift-219"><span class="linenos">219</span></a>            <span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span>
</span><span id="Model.directional_drift-220"><a href="#Model.directional_drift-220"><span class="linenos">220</span></a>        <span class="p">)</span>  <span class="c1"># Current element</span>
</span><span id="Model.directional_drift-221"><a href="#Model.directional_drift-221"><span class="linenos">221</span></a>        <span class="n">max_directional_drift_probs</span><span class="p">[</span>
</span><span id="Model.directional_drift-222"><a href="#Model.directional_drift-222"><span class="linenos">222</span></a>            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">direction_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">LEN_DIRECTIONS</span>
</span><span id="Model.directional_drift-223"><a href="#Model.directional_drift-223"><span class="linenos">223</span></a>        <span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
</span><span id="Model.directional_drift-224"><a href="#Model.directional_drift-224"><span class="linenos">224</span></a>            <span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span>
</span><span id="Model.directional_drift-225"><a href="#Model.directional_drift-225"><span class="linenos">225</span></a>        <span class="p">)</span>  <span class="c1"># Next element</span>
</span><span id="Model.directional_drift-226"><a href="#Model.directional_drift-226"><span class="linenos">226</span></a>        <span class="n">probabilities_directional_drift</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">DIRECTIONAL_DRIFT</span><span class="p">)</span> <span class="o">*</span> <span class="n">uniform_probs</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span>
</span><span id="Model.directional_drift-227"><a href="#Model.directional_drift-227"><span class="linenos">227</span></a>            <span class="n">DIRECTIONAL_DRIFT</span> <span class="o">*</span> <span class="n">max_directional_drift_probs</span>
</span><span id="Model.directional_drift-228"><a href="#Model.directional_drift-228"><span class="linenos">228</span></a>        <span class="p">)</span>
</span><span id="Model.directional_drift-229"><a href="#Model.directional_drift-229"><span class="linenos">229</span></a>
</span><span id="Model.directional_drift-230"><a href="#Model.directional_drift-230"><span class="linenos">230</span></a>        <span class="c1"># Assert that probabilities sum to 1</span>
</span><span id="Model.directional_drift-231"><a href="#Model.directional_drift-231"><span class="linenos">231</span></a>        <span class="n">assert_if_debug</span><span class="p">(</span>
</span><span id="Model.directional_drift-232"><a href="#Model.directional_drift-232"><span class="linenos">232</span></a>            <span class="s2">&quot;np.isclose(probabilities_directional_drift.sum(), 1)&quot;</span><span class="p">,</span>
</span><span id="Model.directional_drift-233"><a href="#Model.directional_drift-233"><span class="linenos">233</span></a>            <span class="s2">&quot;Probabilities must sum to 1&quot;</span><span class="p">,</span>
</span><span id="Model.directional_drift-234"><a href="#Model.directional_drift-234"><span class="linenos">234</span></a>        <span class="p">)</span>
</span><span id="Model.directional_drift-235"><a href="#Model.directional_drift-235"><span class="linenos">235</span></a>        <span class="k">return</span> <span class="n">probabilities_directional_drift</span>
</span></pre></div>


            <div class="docstring"><p>Given the previous direction, this function assigns probabilites
to the directions of next move. Directions forward (with respect to the
previous direction) are more likely due to directional drift.</p>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>The probabilities of the next move</p>
</blockquote>
</div>


                            </div>
                            <div id="Model.growing_radius" class="classattr">
                                        <input id="Model.growing_radius-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">growing_radius</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Model.growing_radius-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Model.growing_radius"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Model.growing_radius-237"><a href="#Model.growing_radius-237"><span class="linenos">237</span></a>    <span class="k">def</span> <span class="nf">growing_radius</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Model.growing_radius-238"><a href="#Model.growing_radius-238"><span class="linenos">238</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates the radius where the particles appear. This radius</span>
</span><span id="Model.growing_radius-239"><a href="#Model.growing_radius-239"><span class="linenos">239</span></a><span class="sd">        grows logarithmically as a function of structure size</span>
</span><span id="Model.growing_radius-240"><a href="#Model.growing_radius-240"><span class="linenos">240</span></a>
</span><span id="Model.growing_radius-241"><a href="#Model.growing_radius-241"><span class="linenos">241</span></a><span class="sd">        :return: The radius where the particles appear</span>
</span><span id="Model.growing_radius-242"><a href="#Model.growing_radius-242"><span class="linenos">242</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Model.growing_radius-243"><a href="#Model.growing_radius-243"><span class="linenos">243</span></a>        <span class="n">radius</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">R_SCALING_FACTOR</span>
</span><span id="Model.growing_radius-244"><a href="#Model.growing_radius-244"><span class="linenos">244</span></a>
</span><span id="Model.growing_radius-245"><a href="#Model.growing_radius-245"><span class="linenos">245</span></a>        <span class="k">assert</span> <span class="n">radius</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Radius must be positive, check R_SCALING_FACTOR.&quot;</span>
</span><span id="Model.growing_radius-246"><a href="#Model.growing_radius-246"><span class="linenos">246</span></a>
</span><span id="Model.growing_radius-247"><a href="#Model.growing_radius-247"><span class="linenos">247</span></a>        <span class="c1"># Return the radius if it is within bounds, otherwise return the</span>
</span><span id="Model.growing_radius-248"><a href="#Model.growing_radius-248"><span class="linenos">248</span></a>        <span class="c1"># maximum possible radius</span>
</span><span id="Model.growing_radius-249"><a href="#Model.growing_radius-249"><span class="linenos">249</span></a>        <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Calculates the radius where the particles appear. This radius
grows logarithmically as a function of structure size</p>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>The radius where the particles appear</p>
</blockquote>
</div>


                            </div>
                            <div id="Model.norm_vector_to_center" class="classattr">
                                        <input id="Model.norm_vector_to_center-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">norm_vector_to_center</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">x</span>, </span><span class="param"><span class="n">y</span>, </span><span class="param"><span class="n">center_x</span>, </span><span class="param"><span class="n">center_y</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Model.norm_vector_to_center-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Model.norm_vector_to_center"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Model.norm_vector_to_center-251"><a href="#Model.norm_vector_to_center-251"><span class="linenos">251</span></a>    <span class="k">def</span> <span class="nf">norm_vector_to_center</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">center_x</span><span class="p">,</span> <span class="n">center_y</span><span class="p">):</span>
</span><span id="Model.norm_vector_to_center-252"><a href="#Model.norm_vector_to_center-252"><span class="linenos">252</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Takes coordinates of current position and coordinates of some</span>
</span><span id="Model.norm_vector_to_center-253"><a href="#Model.norm_vector_to_center-253"><span class="linenos">253</span></a><span class="sd">        center (settlement). Returns a normalized vector to that center.</span>
</span><span id="Model.norm_vector_to_center-254"><a href="#Model.norm_vector_to_center-254"><span class="linenos">254</span></a>
</span><span id="Model.norm_vector_to_center-255"><a href="#Model.norm_vector_to_center-255"><span class="linenos">255</span></a><span class="sd">        :param x: The x-coordinate of the current position</span>
</span><span id="Model.norm_vector_to_center-256"><a href="#Model.norm_vector_to_center-256"><span class="linenos">256</span></a><span class="sd">        :param y: The y-coordinate of the current position</span>
</span><span id="Model.norm_vector_to_center-257"><a href="#Model.norm_vector_to_center-257"><span class="linenos">257</span></a><span class="sd">        :param center_x: The x-coordinate of the center</span>
</span><span id="Model.norm_vector_to_center-258"><a href="#Model.norm_vector_to_center-258"><span class="linenos">258</span></a><span class="sd">        :param center_y: The y-coordinate of the center</span>
</span><span id="Model.norm_vector_to_center-259"><a href="#Model.norm_vector_to_center-259"><span class="linenos">259</span></a><span class="sd">        :return: The normalized vector to the center</span>
</span><span id="Model.norm_vector_to_center-260"><a href="#Model.norm_vector_to_center-260"><span class="linenos">260</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Model.norm_vector_to_center-261"><a href="#Model.norm_vector_to_center-261"><span class="linenos">261</span></a>
</span><span id="Model.norm_vector_to_center-262"><a href="#Model.norm_vector_to_center-262"><span class="linenos">262</span></a>        <span class="c1"># Assert that the arguments are valid</span>
</span><span id="Model.norm_vector_to_center-263"><a href="#Model.norm_vector_to_center-263"><span class="linenos">263</span></a>        <span class="k">assert</span> <span class="p">(</span>
</span><span id="Model.norm_vector_to_center-264"><a href="#Model.norm_vector_to_center-264"><span class="linenos">264</span></a>            <span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span>
</span><span id="Model.norm_vector_to_center-265"><a href="#Model.norm_vector_to_center-265"><span class="linenos">265</span></a>        <span class="p">),</span> <span class="s2">&quot;Current position must be within bounds&quot;</span>
</span><span id="Model.norm_vector_to_center-266"><a href="#Model.norm_vector_to_center-266"><span class="linenos">266</span></a>        <span class="k">assert</span> <span class="p">(</span>
</span><span id="Model.norm_vector_to_center-267"><a href="#Model.norm_vector_to_center-267"><span class="linenos">267</span></a>            <span class="n">center_x</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">center_x</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="ow">and</span> <span class="n">center_y</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">center_y</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span>
</span><span id="Model.norm_vector_to_center-268"><a href="#Model.norm_vector_to_center-268"><span class="linenos">268</span></a>        <span class="p">),</span> <span class="s2">&quot;Center must be within bounds&quot;</span>
</span><span id="Model.norm_vector_to_center-269"><a href="#Model.norm_vector_to_center-269"><span class="linenos">269</span></a>
</span><span id="Model.norm_vector_to_center-270"><a href="#Model.norm_vector_to_center-270"><span class="linenos">270</span></a>        <span class="c1"># Get vector pointing to the center from current position</span>
</span><span id="Model.norm_vector_to_center-271"><a href="#Model.norm_vector_to_center-271"><span class="linenos">271</span></a>        <span class="n">vector_to_center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">center_x</span> <span class="o">-</span> <span class="n">x</span><span class="p">,</span> <span class="n">center_y</span> <span class="o">-</span> <span class="n">y</span><span class="p">])</span>
</span><span id="Model.norm_vector_to_center-272"><a href="#Model.norm_vector_to_center-272"><span class="linenos">272</span></a>
</span><span id="Model.norm_vector_to_center-273"><a href="#Model.norm_vector_to_center-273"><span class="linenos">273</span></a>        <span class="c1"># Get the norm of the vector, but faster than numpy :)</span>
</span><span id="Model.norm_vector_to_center-274"><a href="#Model.norm_vector_to_center-274"><span class="linenos">274</span></a>        <span class="n">norm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">center_x</span><span class="p">,</span> <span class="n">center_y</span><span class="p">)</span>
</span><span id="Model.norm_vector_to_center-275"><a href="#Model.norm_vector_to_center-275"><span class="linenos">275</span></a>
</span><span id="Model.norm_vector_to_center-276"><a href="#Model.norm_vector_to_center-276"><span class="linenos">276</span></a>        <span class="c1"># Normalize vector</span>
</span><span id="Model.norm_vector_to_center-277"><a href="#Model.norm_vector_to_center-277"><span class="linenos">277</span></a>        <span class="k">if</span> <span class="n">norm</span><span class="p">:</span>
</span><span id="Model.norm_vector_to_center-278"><a href="#Model.norm_vector_to_center-278"><span class="linenos">278</span></a>            <span class="n">normalized_vector_to_center</span> <span class="o">=</span> <span class="n">vector_to_center</span> <span class="o">/</span> <span class="n">norm</span>
</span><span id="Model.norm_vector_to_center-279"><a href="#Model.norm_vector_to_center-279"><span class="linenos">279</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Model.norm_vector_to_center-280"><a href="#Model.norm_vector_to_center-280"><span class="linenos">280</span></a>            <span class="n">normalized_vector_to_center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
</span><span id="Model.norm_vector_to_center-281"><a href="#Model.norm_vector_to_center-281"><span class="linenos">281</span></a>
</span><span id="Model.norm_vector_to_center-282"><a href="#Model.norm_vector_to_center-282"><span class="linenos">282</span></a>        <span class="k">return</span> <span class="n">normalized_vector_to_center</span>
</span></pre></div>


            <div class="docstring"><p>Takes coordinates of current position and coordinates of some
center (settlement). Returns a normalized vector to that center.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>x</strong>:  The x-coordinate of the current position</li>
<li><strong>y</strong>:  The y-coordinate of the current position</li>
<li><strong>center_x</strong>:  The x-coordinate of the center</li>
<li><strong>center_y</strong>:  The y-coordinate of the center</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>The normalized vector to the center</p>
</blockquote>
</div>


                            </div>
                            <div id="Model.distance" class="classattr">
                                        <input id="Model.distance-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">distance</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">x1</span>, </span><span class="param"><span class="n">y1</span>, </span><span class="param"><span class="n">x2</span>, </span><span class="param"><span class="n">y2</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Model.distance-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Model.distance"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Model.distance-284"><a href="#Model.distance-284"><span class="linenos">284</span></a>    <span class="k">def</span> <span class="nf">distance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">):</span>
</span><span id="Model.distance-285"><a href="#Model.distance-285"><span class="linenos">285</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates distance between two coordinates.</span>
</span><span id="Model.distance-286"><a href="#Model.distance-286"><span class="linenos">286</span></a>
</span><span id="Model.distance-287"><a href="#Model.distance-287"><span class="linenos">287</span></a><span class="sd">        :param x1: The x-coordinate of the first point</span>
</span><span id="Model.distance-288"><a href="#Model.distance-288"><span class="linenos">288</span></a><span class="sd">        :param y1: The y-coordinate of the first point</span>
</span><span id="Model.distance-289"><a href="#Model.distance-289"><span class="linenos">289</span></a><span class="sd">        :param x2: The x-coordinate of the second point</span>
</span><span id="Model.distance-290"><a href="#Model.distance-290"><span class="linenos">290</span></a><span class="sd">        :param y2: The y-coordinate of the second point</span>
</span><span id="Model.distance-291"><a href="#Model.distance-291"><span class="linenos">291</span></a><span class="sd">        :return: The distance between the two points</span>
</span><span id="Model.distance-292"><a href="#Model.distance-292"><span class="linenos">292</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Model.distance-293"><a href="#Model.distance-293"><span class="linenos">293</span></a>        <span class="n">assert_if_debug</span><span class="p">(</span>
</span><span id="Model.distance-294"><a href="#Model.distance-294"><span class="linenos">294</span></a>            <span class="s2">&quot;is_numeric(x1) and is_numeric(y1) and is_numeric(x2) and is_numeric(y2)&quot;</span><span class="p">,</span>
</span><span id="Model.distance-295"><a href="#Model.distance-295"><span class="linenos">295</span></a>            <span class="s2">&quot;Coordinates must be numeric&quot;</span><span class="p">,</span>
</span><span id="Model.distance-296"><a href="#Model.distance-296"><span class="linenos">296</span></a>        <span class="p">)</span>
</span><span id="Model.distance-297"><a href="#Model.distance-297"><span class="linenos">297</span></a>
</span><span id="Model.distance-298"><a href="#Model.distance-298"><span class="linenos">298</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Calculates distance between two coordinates.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>x1</strong>:  The x-coordinate of the first point</li>
<li><strong>y1</strong>:  The y-coordinate of the first point</li>
<li><strong>x2</strong>:  The x-coordinate of the second point</li>
<li><strong>y2</strong>:  The y-coordinate of the second point</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>The distance between the two points</p>
</blockquote>
</div>


                            </div>
                            <div id="Model.update" class="classattr">
                                        <input id="Model.update-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">update</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">stickiness</span><span class="o">=</span><span class="mf">1.0</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Model.update-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Model.update"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Model.update-300"><a href="#Model.update-300"><span class="linenos">300</span></a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stickiness</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
</span><span id="Model.update-301"><a href="#Model.update-301"><span class="linenos">301</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Spawns a particle and calculates its next coordinate, taking into account</span>
</span><span id="Model.update-302"><a href="#Model.update-302"><span class="linenos">302</span></a><span class="sd">        the directional drift and focal attraction. If multiple settlements are considered,</span>
</span><span id="Model.update-303"><a href="#Model.update-303"><span class="linenos">303</span></a><span class="sd">        the particle is more likely to head in the direction of the closer one.</span>
</span><span id="Model.update-304"><a href="#Model.update-304"><span class="linenos">304</span></a><span class="sd">        Places a settlement once the particle encounters an established structure.</span>
</span><span id="Model.update-305"><a href="#Model.update-305"><span class="linenos">305</span></a><span class="sd">        Stops if movement goes off the grid.</span>
</span><span id="Model.update-306"><a href="#Model.update-306"><span class="linenos">306</span></a>
</span><span id="Model.update-307"><a href="#Model.update-307"><span class="linenos">307</span></a><span class="sd">        :param stickiness: The stickiness of the model. Between 0 and 1</span>
</span><span id="Model.update-308"><a href="#Model.update-308"><span class="linenos">308</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Model.update-309"><a href="#Model.update-309"><span class="linenos">309</span></a>        <span class="k">assert</span> <span class="n">stickiness</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">stickiness</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Stickiness must be between 0 and 1&quot;</span>
</span><span id="Model.update-310"><a href="#Model.update-310"><span class="linenos">310</span></a>
</span><span id="Model.update-311"><a href="#Model.update-311"><span class="linenos">311</span></a>        <span class="c1"># Reset initial direction</span>
</span><span id="Model.update-312"><a href="#Model.update-312"><span class="linenos">312</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">direction_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
</span><span id="Model.update-313"><a href="#Model.update-313"><span class="linenos">313</span></a>
</span><span id="Model.update-314"><a href="#Model.update-314"><span class="linenos">314</span></a>        <span class="c1"># Set grid center coordinates</span>
</span><span id="Model.update-315"><a href="#Model.update-315"><span class="linenos">315</span></a>        <span class="n">center_x</span><span class="p">,</span> <span class="n">center_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="Model.update-316"><a href="#Model.update-316"><span class="linenos">316</span></a>
</span><span id="Model.update-317"><a href="#Model.update-317"><span class="linenos">317</span></a>        <span class="c1"># For multiple settlements define multiple center points</span>
</span><span id="Model.update-318"><a href="#Model.update-318"><span class="linenos">318</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;multiple&quot;</span><span class="p">:</span>
</span><span id="Model.update-319"><a href="#Model.update-319"><span class="linenos">319</span></a>            <span class="n">center1_x</span><span class="p">,</span> <span class="n">center1_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">//</span> <span class="mi">4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">//</span> <span class="mi">4</span>
</span><span id="Model.update-320"><a href="#Model.update-320"><span class="linenos">320</span></a>            <span class="n">center2_x</span><span class="p">,</span> <span class="n">center2_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">//</span> <span class="mi">4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">//</span> <span class="mi">4</span>
</span><span id="Model.update-321"><a href="#Model.update-321"><span class="linenos">321</span></a>            <span class="n">settlement_centers</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Model.update-322"><a href="#Model.update-322"><span class="linenos">322</span></a>                <span class="p">[</span><span class="n">center1_x</span><span class="p">,</span> <span class="n">center1_y</span><span class="p">],</span> <span class="p">[</span><span class="n">center2_x</span><span class="p">,</span> <span class="n">center2_y</span><span class="p">]]</span>
</span><span id="Model.update-323"><a href="#Model.update-323"><span class="linenos">323</span></a>
</span><span id="Model.update-324"><a href="#Model.update-324"><span class="linenos">324</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">particle_generation</span> <span class="o">==</span> <span class="s2">&quot;on_radius&quot;</span><span class="p">:</span>
</span><span id="Model.update-325"><a href="#Model.update-325"><span class="linenos">325</span></a>            <span class="c1"># Set growing radius</span>
</span><span id="Model.update-326"><a href="#Model.update-326"><span class="linenos">326</span></a>            <span class="n">radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">growing_radius</span><span class="p">()</span>
</span><span id="Model.update-327"><a href="#Model.update-327"><span class="linenos">327</span></a>
</span><span id="Model.update-328"><a href="#Model.update-328"><span class="linenos">328</span></a>            <span class="c1"># Set the walker to be a particle at a random point on the edge of</span>
</span><span id="Model.update-329"><a href="#Model.update-329"><span class="linenos">329</span></a>            <span class="c1"># a circle</span>
</span><span id="Model.update-330"><a href="#Model.update-330"><span class="linenos">330</span></a>            <span class="n">angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
</span><span id="Model.update-331"><a href="#Model.update-331"><span class="linenos">331</span></a>            <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">center_x</span> <span class="o">+</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">))</span>
</span><span id="Model.update-332"><a href="#Model.update-332"><span class="linenos">332</span></a>            <span class="n">y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">center_y</span> <span class="o">+</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">))</span>
</span><span id="Model.update-333"><a href="#Model.update-333"><span class="linenos">333</span></a>
</span><span id="Model.update-334"><a href="#Model.update-334"><span class="linenos">334</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">particle_generation</span> <span class="o">==</span> <span class="s2">&quot;anywhere&quot;</span><span class="p">:</span>
</span><span id="Model.update-335"><a href="#Model.update-335"><span class="linenos">335</span></a>            <span class="c1"># Spawn particle randomly</span>
</span><span id="Model.update-336"><a href="#Model.update-336"><span class="linenos">336</span></a>            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">)</span>
</span><span id="Model.update-337"><a href="#Model.update-337"><span class="linenos">337</span></a>            <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">)</span>
</span><span id="Model.update-338"><a href="#Model.update-338"><span class="linenos">338</span></a>
</span><span id="Model.update-339"><a href="#Model.update-339"><span class="linenos">339</span></a>        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="o">==</span> <span class="n">NO_STRUCTURE</span><span class="p">:</span>
</span><span id="Model.update-340"><a href="#Model.update-340"><span class="linenos">340</span></a>            <span class="n">old_x</span><span class="p">,</span> <span class="n">old_y</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
</span><span id="Model.update-341"><a href="#Model.update-341"><span class="linenos">341</span></a>
</span><span id="Model.update-342"><a href="#Model.update-342"><span class="linenos">342</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;single&quot;</span><span class="p">:</span>
</span><span id="Model.update-343"><a href="#Model.update-343"><span class="linenos">343</span></a>                <span class="n">normalized_vector_to_center</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm_vector_to_center</span><span class="p">(</span>
</span><span id="Model.update-344"><a href="#Model.update-344"><span class="linenos">344</span></a>                    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">center_x</span><span class="p">,</span> <span class="n">center_y</span>
</span><span id="Model.update-345"><a href="#Model.update-345"><span class="linenos">345</span></a>                <span class="p">)</span>
</span><span id="Model.update-346"><a href="#Model.update-346"><span class="linenos">346</span></a>
</span><span id="Model.update-347"><a href="#Model.update-347"><span class="linenos">347</span></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;multiple&quot;</span><span class="p">:</span>
</span><span id="Model.update-348"><a href="#Model.update-348"><span class="linenos">348</span></a>                <span class="c1"># Choose a city to go to by calculating probabilites based on</span>
</span><span id="Model.update-349"><a href="#Model.update-349"><span class="linenos">349</span></a>                <span class="c1"># which one is closest</span>
</span><span id="Model.update-350"><a href="#Model.update-350"><span class="linenos">350</span></a>                <span class="n">distances_to_settlements</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Model.update-351"><a href="#Model.update-351"><span class="linenos">351</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">center1_x</span><span class="p">,</span> <span class="n">center1_y</span><span class="p">),</span>
</span><span id="Model.update-352"><a href="#Model.update-352"><span class="linenos">352</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">center2_x</span><span class="p">,</span> <span class="n">center2_y</span><span class="p">),</span>
</span><span id="Model.update-353"><a href="#Model.update-353"><span class="linenos">353</span></a>                <span class="p">]</span>
</span><span id="Model.update-354"><a href="#Model.update-354"><span class="linenos">354</span></a>                <span class="n">city_choice_probabilities</span> <span class="o">=</span> <span class="n">distances_to_settlements</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span>
</span><span id="Model.update-355"><a href="#Model.update-355"><span class="linenos">355</span></a>                    <span class="n">distances_to_settlements</span>
</span><span id="Model.update-356"><a href="#Model.update-356"><span class="linenos">356</span></a>                <span class="p">)</span>
</span><span id="Model.update-357"><a href="#Model.update-357"><span class="linenos">357</span></a>
</span><span id="Model.update-358"><a href="#Model.update-358"><span class="linenos">358</span></a>                <span class="n">city_chosen_index</span> <span class="o">=</span> <span class="n">my_random_function</span><span class="p">(</span>
</span><span id="Model.update-359"><a href="#Model.update-359"><span class="linenos">359</span></a>                    <span class="nb">len</span><span class="p">(</span><span class="n">distances_to_settlements</span><span class="p">),</span> <span class="n">p</span><span class="o">=</span><span class="n">city_choice_probabilities</span>
</span><span id="Model.update-360"><a href="#Model.update-360"><span class="linenos">360</span></a>                <span class="p">)</span>
</span><span id="Model.update-361"><a href="#Model.update-361"><span class="linenos">361</span></a>
</span><span id="Model.update-362"><a href="#Model.update-362"><span class="linenos">362</span></a>                <span class="c1"># Get a normalized vector to chosen center</span>
</span><span id="Model.update-363"><a href="#Model.update-363"><span class="linenos">363</span></a>                <span class="n">center_x</span><span class="p">,</span> <span class="n">center_y</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Model.update-364"><a href="#Model.update-364"><span class="linenos">364</span></a>                    <span class="n">settlement_centers</span><span class="p">[</span><span class="n">city_chosen_index</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
</span><span id="Model.update-365"><a href="#Model.update-365"><span class="linenos">365</span></a>                    <span class="n">settlement_centers</span><span class="p">[</span><span class="n">city_chosen_index</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
</span><span id="Model.update-366"><a href="#Model.update-366"><span class="linenos">366</span></a>                <span class="p">)</span>
</span><span id="Model.update-367"><a href="#Model.update-367"><span class="linenos">367</span></a>                <span class="n">normalized_vector_to_center</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">norm_vector_to_center</span><span class="p">(</span>
</span><span id="Model.update-368"><a href="#Model.update-368"><span class="linenos">368</span></a>                    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">center_x</span><span class="p">,</span> <span class="n">center_y</span>
</span><span id="Model.update-369"><a href="#Model.update-369"><span class="linenos">369</span></a>                <span class="p">)</span>
</span><span id="Model.update-370"><a href="#Model.update-370"><span class="linenos">370</span></a>
</span><span id="Model.update-371"><a href="#Model.update-371"><span class="linenos">371</span></a>            <span class="c1"># Take into account directional drift and focal attraction</span>
</span><span id="Model.update-372"><a href="#Model.update-372"><span class="linenos">372</span></a>            <span class="n">probabilities_focal_attraction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">focal_attraction</span><span class="p">(</span>
</span><span id="Model.update-373"><a href="#Model.update-373"><span class="linenos">373</span></a>                <span class="n">normalized_vector_to_center</span>
</span><span id="Model.update-374"><a href="#Model.update-374"><span class="linenos">374</span></a>            <span class="p">)</span>
</span><span id="Model.update-375"><a href="#Model.update-375"><span class="linenos">375</span></a>            <span class="n">probabilities_directional_drift</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">directional_drift</span><span class="p">()</span>
</span><span id="Model.update-376"><a href="#Model.update-376"><span class="linenos">376</span></a>
</span><span id="Model.update-377"><a href="#Model.update-377"><span class="linenos">377</span></a>            <span class="c1"># Combine directional drift and focal attraction</span>
</span><span id="Model.update-378"><a href="#Model.update-378"><span class="linenos">378</span></a>            <span class="n">probabilities</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Model.update-379"><a href="#Model.update-379"><span class="linenos">379</span></a>                <span class="n">probabilities_focal_attraction</span> <span class="o">+</span> <span class="n">probabilities_directional_drift</span>
</span><span id="Model.update-380"><a href="#Model.update-380"><span class="linenos">380</span></a>            <span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="Model.update-381"><a href="#Model.update-381"><span class="linenos">381</span></a>
</span><span id="Model.update-382"><a href="#Model.update-382"><span class="linenos">382</span></a>            <span class="c1"># Choose direction and move</span>
</span><span id="Model.update-383"><a href="#Model.update-383"><span class="linenos">383</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">direction_index</span> <span class="o">=</span> <span class="n">my_random_function</span><span class="p">(</span>
</span><span id="Model.update-384"><a href="#Model.update-384"><span class="linenos">384</span></a>                <span class="n">LEN_DIRECTIONS</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">probabilities</span><span class="p">)</span>
</span><span id="Model.update-385"><a href="#Model.update-385"><span class="linenos">385</span></a>
</span><span id="Model.update-386"><a href="#Model.update-386"><span class="linenos">386</span></a>            <span class="n">direction</span> <span class="o">=</span> <span class="n">DIRECTIONS</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">direction_index</span><span class="p">]</span>
</span><span id="Model.update-387"><a href="#Model.update-387"><span class="linenos">387</span></a>            <span class="n">x</span> <span class="o">+=</span> <span class="n">direction</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Model.update-388"><a href="#Model.update-388"><span class="linenos">388</span></a>            <span class="n">y</span> <span class="o">+=</span> <span class="n">direction</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Model.update-389"><a href="#Model.update-389"><span class="linenos">389</span></a>
</span><span id="Model.update-390"><a href="#Model.update-390"><span class="linenos">390</span></a>            <span class="c1"># Check if the walker is within bounds</span>
</span><span id="Model.update-391"><a href="#Model.update-391"><span class="linenos">391</span></a>            <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="ow">or</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">y</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">:</span>
</span><span id="Model.update-392"><a href="#Model.update-392"><span class="linenos">392</span></a>                <span class="k">return</span>
</span><span id="Model.update-393"><a href="#Model.update-393"><span class="linenos">393</span></a>
</span><span id="Model.update-394"><a href="#Model.update-394"><span class="linenos">394</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="o">!=</span> <span class="n">NO_STRUCTURE</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span>
</span><span id="Model.update-395"><a href="#Model.update-395"><span class="linenos">395</span></a>            <span class="p">)</span> <span class="o">&gt;</span> <span class="n">stickiness</span><span class="p">:</span>
</span><span id="Model.update-396"><a href="#Model.update-396"><span class="linenos">396</span></a>                <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">old_x</span><span class="p">,</span> <span class="n">old_y</span>
</span><span id="Model.update-397"><a href="#Model.update-397"><span class="linenos">397</span></a>
</span><span id="Model.update-398"><a href="#Model.update-398"><span class="linenos">398</span></a>        <span class="c1"># Set the walker to be a city</span>
</span><span id="Model.update-399"><a href="#Model.update-399"><span class="linenos">399</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="n">old_x</span><span class="p">,</span> <span class="n">old_y</span><span class="p">]</span> <span class="o">=</span> <span class="n">STRUCTURE</span>
</span></pre></div>


            <div class="docstring"><p>Spawns a particle and calculates its next coordinate, taking into account
the directional drift and focal attraction. If multiple settlements are considered,
the particle is more likely to head in the direction of the closer one.
Places a settlement once the particle encounters an established structure.
Stops if movement goes off the grid.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>stickiness</strong>:  The stickiness of the model. Between 0 and 1</li>
</ul>
</div>


                            </div>
                            <div id="Model.update_random_walk" class="classattr">
                                        <input id="Model.update_random_walk-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">update_random_walk</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">stickiness</span><span class="o">=</span><span class="mf">1.0</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Model.update_random_walk-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Model.update_random_walk"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Model.update_random_walk-401"><a href="#Model.update_random_walk-401"><span class="linenos">401</span></a>    <span class="k">def</span> <span class="nf">update_random_walk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stickiness</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
</span><span id="Model.update_random_walk-402"><a href="#Model.update_random_walk-402"><span class="linenos">402</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Spawns a particle on a radius and calculates its next coordinate randomly.</span>
</span><span id="Model.update_random_walk-403"><a href="#Model.update_random_walk-403"><span class="linenos">403</span></a><span class="sd">        Places a settlement once the particle encounters an established structure.</span>
</span><span id="Model.update_random_walk-404"><a href="#Model.update_random_walk-404"><span class="linenos">404</span></a>
</span><span id="Model.update_random_walk-405"><a href="#Model.update_random_walk-405"><span class="linenos">405</span></a><span class="sd">        :param stickiness: The stickiness of the model. Between 0 and 1</span>
</span><span id="Model.update_random_walk-406"><a href="#Model.update_random_walk-406"><span class="linenos">406</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Model.update_random_walk-407"><a href="#Model.update_random_walk-407"><span class="linenos">407</span></a>        <span class="k">assert</span> <span class="n">stickiness</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">stickiness</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Stickiness must be between 0 and 1&quot;</span>
</span><span id="Model.update_random_walk-408"><a href="#Model.update_random_walk-408"><span class="linenos">408</span></a>
</span><span id="Model.update_random_walk-409"><a href="#Model.update_random_walk-409"><span class="linenos">409</span></a>        <span class="c1"># Calculate radius (increases logarithmically as structure grows)</span>
</span><span id="Model.update_random_walk-410"><a href="#Model.update_random_walk-410"><span class="linenos">410</span></a>        <span class="n">radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">growing_radius</span><span class="p">()</span>
</span><span id="Model.update_random_walk-411"><a href="#Model.update_random_walk-411"><span class="linenos">411</span></a>
</span><span id="Model.update_random_walk-412"><a href="#Model.update_random_walk-412"><span class="linenos">412</span></a>        <span class="c1"># Set the walker to be a particle at a random point on the edge of a</span>
</span><span id="Model.update_random_walk-413"><a href="#Model.update_random_walk-413"><span class="linenos">413</span></a>        <span class="c1"># circle</span>
</span><span id="Model.update_random_walk-414"><a href="#Model.update_random_walk-414"><span class="linenos">414</span></a>        <span class="n">angle</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
</span><span id="Model.update_random_walk-415"><a href="#Model.update_random_walk-415"><span class="linenos">415</span></a>
</span><span id="Model.update_random_walk-416"><a href="#Model.update_random_walk-416"><span class="linenos">416</span></a>        <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">))</span>
</span><span id="Model.update_random_walk-417"><a href="#Model.update_random_walk-417"><span class="linenos">417</span></a>        <span class="n">y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">))</span>
</span><span id="Model.update_random_walk-418"><a href="#Model.update_random_walk-418"><span class="linenos">418</span></a>
</span><span id="Model.update_random_walk-419"><a href="#Model.update_random_walk-419"><span class="linenos">419</span></a>        <span class="n">old_x</span><span class="p">,</span> <span class="n">old_y</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
</span><span id="Model.update_random_walk-420"><a href="#Model.update_random_walk-420"><span class="linenos">420</span></a>        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="o">==</span> <span class="n">NO_STRUCTURE</span><span class="p">:</span>
</span><span id="Model.update_random_walk-421"><a href="#Model.update_random_walk-421"><span class="linenos">421</span></a>            <span class="n">old_x</span><span class="p">,</span> <span class="n">old_y</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
</span><span id="Model.update_random_walk-422"><a href="#Model.update_random_walk-422"><span class="linenos">422</span></a>
</span><span id="Model.update_random_walk-423"><a href="#Model.update_random_walk-423"><span class="linenos">423</span></a>            <span class="c1"># Move the walker</span>
</span><span id="Model.update_random_walk-424"><a href="#Model.update_random_walk-424"><span class="linenos">424</span></a>            <span class="n">direction</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="Model.update_random_walk-425"><a href="#Model.update_random_walk-425"><span class="linenos">425</span></a>            <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Model.update_random_walk-426"><a href="#Model.update_random_walk-426"><span class="linenos">426</span></a>                <span class="n">x</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Model.update_random_walk-427"><a href="#Model.update_random_walk-427"><span class="linenos">427</span></a>            <span class="k">elif</span> <span class="n">direction</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Model.update_random_walk-428"><a href="#Model.update_random_walk-428"><span class="linenos">428</span></a>                <span class="n">x</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="Model.update_random_walk-429"><a href="#Model.update_random_walk-429"><span class="linenos">429</span></a>            <span class="k">elif</span> <span class="n">direction</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="Model.update_random_walk-430"><a href="#Model.update_random_walk-430"><span class="linenos">430</span></a>                <span class="n">y</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Model.update_random_walk-431"><a href="#Model.update_random_walk-431"><span class="linenos">431</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Model.update_random_walk-432"><a href="#Model.update_random_walk-432"><span class="linenos">432</span></a>                <span class="n">y</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="Model.update_random_walk-433"><a href="#Model.update_random_walk-433"><span class="linenos">433</span></a>
</span><span id="Model.update_random_walk-434"><a href="#Model.update_random_walk-434"><span class="linenos">434</span></a>            <span class="c1"># Check if the walker is within bounds</span>
</span><span id="Model.update_random_walk-435"><a href="#Model.update_random_walk-435"><span class="linenos">435</span></a>            <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Model.update_random_walk-436"><a href="#Model.update_random_walk-436"><span class="linenos">436</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Model.update_random_walk-437"><a href="#Model.update_random_walk-437"><span class="linenos">437</span></a>            <span class="k">elif</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span><span class="p">:</span>
</span><span id="Model.update_random_walk-438"><a href="#Model.update_random_walk-438"><span class="linenos">438</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="Model.update_random_walk-439"><a href="#Model.update_random_walk-439"><span class="linenos">439</span></a>
</span><span id="Model.update_random_walk-440"><a href="#Model.update_random_walk-440"><span class="linenos">440</span></a>            <span class="k">if</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Model.update_random_walk-441"><a href="#Model.update_random_walk-441"><span class="linenos">441</span></a>                <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Model.update_random_walk-442"><a href="#Model.update_random_walk-442"><span class="linenos">442</span></a>            <span class="k">elif</span> <span class="n">y</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">:</span>
</span><span id="Model.update_random_walk-443"><a href="#Model.update_random_walk-443"><span class="linenos">443</span></a>                <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="Model.update_random_walk-444"><a href="#Model.update_random_walk-444"><span class="linenos">444</span></a>
</span><span id="Model.update_random_walk-445"><a href="#Model.update_random_walk-445"><span class="linenos">445</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="o">!=</span> <span class="n">NO_STRUCTURE</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span>
</span><span id="Model.update_random_walk-446"><a href="#Model.update_random_walk-446"><span class="linenos">446</span></a>            <span class="p">)</span> <span class="o">&gt;</span> <span class="n">stickiness</span><span class="p">:</span>
</span><span id="Model.update_random_walk-447"><a href="#Model.update_random_walk-447"><span class="linenos">447</span></a>                <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">old_x</span><span class="p">,</span> <span class="n">old_y</span>
</span><span id="Model.update_random_walk-448"><a href="#Model.update_random_walk-448"><span class="linenos">448</span></a>
</span><span id="Model.update_random_walk-449"><a href="#Model.update_random_walk-449"><span class="linenos">449</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="n">old_x</span><span class="p">,</span> <span class="n">old_y</span><span class="p">]</span> <span class="o">=</span> <span class="n">STRUCTURE</span>
</span></pre></div>


            <div class="docstring"><p>Spawns a particle on a radius and calculates its next coordinate randomly.
Places a settlement once the particle encounters an established structure.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>stickiness</strong>:  The stickiness of the model. Between 0 and 1</li>
</ul>
</div>


                            </div>
                            <div id="Model.get_box_count" class="classattr">
                                        <input id="Model.get_box_count-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_box_count</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">s</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Model.get_box_count-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Model.get_box_count"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Model.get_box_count-451"><a href="#Model.get_box_count-451"><span class="linenos">451</span></a>    <span class="k">def</span> <span class="nf">get_box_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
</span><span id="Model.get_box_count-452"><a href="#Model.get_box_count-452"><span class="linenos">452</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper function for calculating the fractal dimension using the box counting method.</span>
</span><span id="Model.get_box_count-453"><a href="#Model.get_box_count-453"><span class="linenos">453</span></a><span class="sd">        Calculates and returns N, where N is the number of boxes that contain a developed part</span>
</span><span id="Model.get_box_count-454"><a href="#Model.get_box_count-454"><span class="linenos">454</span></a><span class="sd">        of the city and s is the size of each box.</span>
</span><span id="Model.get_box_count-455"><a href="#Model.get_box_count-455"><span class="linenos">455</span></a>
</span><span id="Model.get_box_count-456"><a href="#Model.get_box_count-456"><span class="linenos">456</span></a><span class="sd">        :param s: The size of each box</span>
</span><span id="Model.get_box_count-457"><a href="#Model.get_box_count-457"><span class="linenos">457</span></a><span class="sd">        :return: N, the number of developed cells.</span>
</span><span id="Model.get_box_count-458"><a href="#Model.get_box_count-458"><span class="linenos">458</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Model.get_box_count-459"><a href="#Model.get_box_count-459"><span class="linenos">459</span></a>
</span><span id="Model.get_box_count-460"><a href="#Model.get_box_count-460"><span class="linenos">460</span></a>        <span class="c1"># Assert that the argument n_boxes is valid</span>
</span><span id="Model.get_box_count-461"><a href="#Model.get_box_count-461"><span class="linenos">461</span></a>        <span class="k">assert</span> <span class="n">s</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Number of boxes must be positive&quot;</span>
</span><span id="Model.get_box_count-462"><a href="#Model.get_box_count-462"><span class="linenos">462</span></a>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="s2">&quot;Number of boxes must be an integer&quot;</span>
</span><span id="Model.get_box_count-463"><a href="#Model.get_box_count-463"><span class="linenos">463</span></a>
</span><span id="Model.get_box_count-464"><a href="#Model.get_box_count-464"><span class="linenos">464</span></a>        <span class="c1"># The size of each box</span>
</span><span id="Model.get_box_count-465"><a href="#Model.get_box_count-465"><span class="linenos">465</span></a>        <span class="n">box_size</span> <span class="o">=</span> <span class="n">s</span>
</span><span id="Model.get_box_count-466"><a href="#Model.get_box_count-466"><span class="linenos">466</span></a>        <span class="n">n_boxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">//</span> <span class="n">s</span>
</span><span id="Model.get_box_count-467"><a href="#Model.get_box_count-467"><span class="linenos">467</span></a>
</span><span id="Model.get_box_count-468"><a href="#Model.get_box_count-468"><span class="linenos">468</span></a>        <span class="c1"># The number of boxes that contain a city</span>
</span><span id="Model.get_box_count-469"><a href="#Model.get_box_count-469"><span class="linenos">469</span></a>        <span class="n">n_filled_boxes</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Model.get_box_count-470"><a href="#Model.get_box_count-470"><span class="linenos">470</span></a>
</span><span id="Model.get_box_count-471"><a href="#Model.get_box_count-471"><span class="linenos">471</span></a>        <span class="c1"># Loop over all boxes</span>
</span><span id="Model.get_box_count-472"><a href="#Model.get_box_count-472"><span class="linenos">472</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_boxes</span><span class="p">):</span>
</span><span id="Model.get_box_count-473"><a href="#Model.get_box_count-473"><span class="linenos">473</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_boxes</span><span class="p">):</span>
</span><span id="Model.get_box_count-474"><a href="#Model.get_box_count-474"><span class="linenos">474</span></a>                <span class="c1"># Check if the box contains a city</span>
</span><span id="Model.get_box_count-475"><a href="#Model.get_box_count-475"><span class="linenos">475</span></a>                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span>
</span><span id="Model.get_box_count-476"><a href="#Model.get_box_count-476"><span class="linenos">476</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span>
</span><span id="Model.get_box_count-477"><a href="#Model.get_box_count-477"><span class="linenos">477</span></a>                        <span class="n">i</span> <span class="o">*</span> <span class="n">box_size</span><span class="p">:</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">box_size</span><span class="p">,</span>
</span><span id="Model.get_box_count-478"><a href="#Model.get_box_count-478"><span class="linenos">478</span></a>                        <span class="n">j</span> <span class="o">*</span> <span class="n">box_size</span><span class="p">:</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">box_size</span><span class="p">,</span>
</span><span id="Model.get_box_count-479"><a href="#Model.get_box_count-479"><span class="linenos">479</span></a>                    <span class="p">]</span>
</span><span id="Model.get_box_count-480"><a href="#Model.get_box_count-480"><span class="linenos">480</span></a>                    <span class="o">==</span> <span class="n">STRUCTURE</span>
</span><span id="Model.get_box_count-481"><a href="#Model.get_box_count-481"><span class="linenos">481</span></a>                <span class="p">):</span>
</span><span id="Model.get_box_count-482"><a href="#Model.get_box_count-482"><span class="linenos">482</span></a>                    <span class="n">n_filled_boxes</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Model.get_box_count-483"><a href="#Model.get_box_count-483"><span class="linenos">483</span></a>
</span><span id="Model.get_box_count-484"><a href="#Model.get_box_count-484"><span class="linenos">484</span></a>        <span class="c1"># Calculate the fractal dimension</span>
</span><span id="Model.get_box_count-485"><a href="#Model.get_box_count-485"><span class="linenos">485</span></a>        <span class="k">return</span> <span class="n">n_filled_boxes</span>
</span></pre></div>


            <div class="docstring"><p>Helper function for calculating the fractal dimension using the box counting method.
Calculates and returns N, where N is the number of boxes that contain a developed part
of the city and s is the size of each box.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>s</strong>:  The size of each box</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>N, the number of developed cells.</p>
</blockquote>
</div>


                            </div>
                            <div id="Model.get_fractal_dim" class="classattr">
                                        <input id="Model.get_fractal_dim-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_fractal_dim</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Model.get_fractal_dim-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Model.get_fractal_dim"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Model.get_fractal_dim-487"><a href="#Model.get_fractal_dim-487"><span class="linenos">487</span></a>    <span class="k">def</span> <span class="nf">get_fractal_dim</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Model.get_fractal_dim-488"><a href="#Model.get_fractal_dim-488"><span class="linenos">488</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates the fractal dimension using the box counting method.</span>
</span><span id="Model.get_fractal_dim-489"><a href="#Model.get_fractal_dim-489"><span class="linenos">489</span></a>
</span><span id="Model.get_fractal_dim-490"><a href="#Model.get_fractal_dim-490"><span class="linenos">490</span></a><span class="sd">        This method divides the grid into n_boxes*n_boxes boxes and counts the number of boxes that contain a city.</span>
</span><span id="Model.get_fractal_dim-491"><a href="#Model.get_fractal_dim-491"><span class="linenos">491</span></a><span class="sd">        The result can be used to calculate the fractal dimension using the following formula:</span>
</span><span id="Model.get_fractal_dim-492"><a href="#Model.get_fractal_dim-492"><span class="linenos">492</span></a><span class="sd">        N(s)*s^D = C (Mandelbrot 1983)</span>
</span><span id="Model.get_fractal_dim-493"><a href="#Model.get_fractal_dim-493"><span class="linenos">493</span></a><span class="sd">        We estimate slope D to equation Log(N(s)) = Log(C) + Dlog(1/s) + error [1]</span>
</span><span id="Model.get_fractal_dim-494"><a href="#Model.get_fractal_dim-494"><span class="linenos">494</span></a><span class="sd">        where N is the number of boxes that contain a city, s is the size of each box, and D is the fractal dimension.</span>
</span><span id="Model.get_fractal_dim-495"><a href="#Model.get_fractal_dim-495"><span class="linenos">495</span></a>
</span><span id="Model.get_fractal_dim-496"><a href="#Model.get_fractal_dim-496"><span class="linenos">496</span></a><span class="sd">        [1] Guoqiang Shen, &quot;Fractal dimension and fractal growth of urbanized areas&quot;</span>
</span><span id="Model.get_fractal_dim-497"><a href="#Model.get_fractal_dim-497"><span class="linenos">497</span></a>
</span><span id="Model.get_fractal_dim-498"><a href="#Model.get_fractal_dim-498"><span class="linenos">498</span></a><span class="sd">        :return: The fractal dimension</span>
</span><span id="Model.get_fractal_dim-499"><a href="#Model.get_fractal_dim-499"><span class="linenos">499</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Model.get_fractal_dim-500"><a href="#Model.get_fractal_dim-500"><span class="linenos">500</span></a>        <span class="c1"># store for different box sizes</span>
</span><span id="Model.get_fractal_dim-501"><a href="#Model.get_fractal_dim-501"><span class="linenos">501</span></a>        <span class="n">log_N</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Model.get_fractal_dim-502"><a href="#Model.get_fractal_dim-502"><span class="linenos">502</span></a>        <span class="n">log_1_over_s</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Model.get_fractal_dim-503"><a href="#Model.get_fractal_dim-503"><span class="linenos">503</span></a>
</span><span id="Model.get_fractal_dim-504"><a href="#Model.get_fractal_dim-504"><span class="linenos">504</span></a>        <span class="c1"># Collect data for different box sizes</span>
</span><span id="Model.get_fractal_dim-505"><a href="#Model.get_fractal_dim-505"><span class="linenos">505</span></a>        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)):</span>
</span><span id="Model.get_fractal_dim-506"><a href="#Model.get_fractal_dim-506"><span class="linenos">506</span></a>            <span class="n">N</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_box_count</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</span><span id="Model.get_fractal_dim-507"><a href="#Model.get_fractal_dim-507"><span class="linenos">507</span></a>            <span class="n">log_N</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
</span><span id="Model.get_fractal_dim-508"><a href="#Model.get_fractal_dim-508"><span class="linenos">508</span></a>            <span class="n">log_1_over_s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">s</span><span class="p">))</span>
</span><span id="Model.get_fractal_dim-509"><a href="#Model.get_fractal_dim-509"><span class="linenos">509</span></a>
</span><span id="Model.get_fractal_dim-510"><a href="#Model.get_fractal_dim-510"><span class="linenos">510</span></a>        <span class="k">def</span> <span class="nf">line_to_fit</span><span class="p">(</span><span class="n">log_1_over_s</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">):</span>
</span><span id="Model.get_fractal_dim-511"><a href="#Model.get_fractal_dim-511"><span class="linenos">511</span></a>            <span class="k">return</span> <span class="n">C</span> <span class="o">+</span> <span class="n">D</span> <span class="o">*</span> <span class="n">log_1_over_s</span>
</span><span id="Model.get_fractal_dim-512"><a href="#Model.get_fractal_dim-512"><span class="linenos">512</span></a>
</span><span id="Model.get_fractal_dim-513"><a href="#Model.get_fractal_dim-513"><span class="linenos">513</span></a>        <span class="c1"># Fit a line over the data to get slope D i.e. the fractal dimension</span>
</span><span id="Model.get_fractal_dim-514"><a href="#Model.get_fractal_dim-514"><span class="linenos">514</span></a>        <span class="n">params</span><span class="p">,</span> <span class="n">cov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">line_to_fit</span><span class="p">,</span> <span class="n">log_1_over_s</span><span class="p">,</span> <span class="n">log_N</span><span class="p">)</span>
</span><span id="Model.get_fractal_dim-515"><a href="#Model.get_fractal_dim-515"><span class="linenos">515</span></a>        <span class="n">_</span><span class="p">,</span> <span class="n">D_fit</span> <span class="o">=</span> <span class="n">params</span>
</span><span id="Model.get_fractal_dim-516"><a href="#Model.get_fractal_dim-516"><span class="linenos">516</span></a>
</span><span id="Model.get_fractal_dim-517"><a href="#Model.get_fractal_dim-517"><span class="linenos">517</span></a>        <span class="k">return</span> <span class="n">D_fit</span>
</span></pre></div>


            <div class="docstring"><p>Calculates the fractal dimension using the box counting method.</p>

<p>This method divides the grid into n_boxes<em>n_boxes boxes and counts the number of boxes that contain a city.
The result can be used to calculate the fractal dimension using the following formula:
N(s)</em>s^D = C (Mandelbrot 1983)
We estimate slope D to equation Log(N(s)) = Log(C) + Dlog(1/s) + error [1]
where N is the number of boxes that contain a city, s is the size of each box, and D is the fractal dimension.</p>

<p>[1] Guoqiang Shen, "Fractal dimension and fractal growth of urbanized areas"</p>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>The fractal dimension</p>
</blockquote>
</div>


                            </div>
                            <div id="Model.density_gradient" class="classattr">
                                        <input id="Model.density_gradient-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">density_gradient</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">buffer_size</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Model.density_gradient-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Model.density_gradient"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Model.density_gradient-519"><a href="#Model.density_gradient-519"><span class="linenos">519</span></a>    <span class="k">def</span> <span class="nf">density_gradient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buffer_size</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Model.density_gradient-520"><a href="#Model.density_gradient-520"><span class="linenos">520</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates the density gradient of the city.</span>
</span><span id="Model.density_gradient-521"><a href="#Model.density_gradient-521"><span class="linenos">521</span></a>
</span><span id="Model.density_gradient-522"><a href="#Model.density_gradient-522"><span class="linenos">522</span></a><span class="sd">        The density gradient is calculated by dividing the city into rings of increasing radius and calculating the density of each ring.</span>
</span><span id="Model.density_gradient-523"><a href="#Model.density_gradient-523"><span class="linenos">523</span></a><span class="sd">        The density of a ring is the number of developed cells in the ring divided by the number of cells in the ring.</span>
</span><span id="Model.density_gradient-524"><a href="#Model.density_gradient-524"><span class="linenos">524</span></a>
</span><span id="Model.density_gradient-525"><a href="#Model.density_gradient-525"><span class="linenos">525</span></a><span class="sd">        :param buffer_size: The size of the buffer between rings</span>
</span><span id="Model.density_gradient-526"><a href="#Model.density_gradient-526"><span class="linenos">526</span></a><span class="sd">        :return: The distances and densities of the rings</span>
</span><span id="Model.density_gradient-527"><a href="#Model.density_gradient-527"><span class="linenos">527</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Model.density_gradient-528"><a href="#Model.density_gradient-528"><span class="linenos">528</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">buffer_size</span><span class="p">:</span>
</span><span id="Model.density_gradient-529"><a href="#Model.density_gradient-529"><span class="linenos">529</span></a>            <span class="n">buffer_size</span> <span class="o">=</span> <span class="n">DEFAULT_BUFFER_SIZE</span>
</span><span id="Model.density_gradient-530"><a href="#Model.density_gradient-530"><span class="linenos">530</span></a>        <span class="n">center</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">w</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="Model.density_gradient-531"><a href="#Model.density_gradient-531"><span class="linenos">531</span></a>        <span class="n">distances</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Model.density_gradient-532"><a href="#Model.density_gradient-532"><span class="linenos">532</span></a>        <span class="n">densities</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Model.density_gradient-533"><a href="#Model.density_gradient-533"><span class="linenos">533</span></a>        <span class="k">for</span> <span class="n">radius</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">buffer_size</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">buffer_size</span><span class="p">):</span>
</span><span id="Model.density_gradient-534"><a href="#Model.density_gradient-534"><span class="linenos">534</span></a>            <span class="c1"># define the outer circle of the current ring</span>
</span><span id="Model.density_gradient-535"><a href="#Model.density_gradient-535"><span class="linenos">535</span></a>            <span class="n">outer_mask</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Model.density_gradient-536"><a href="#Model.density_gradient-536"><span class="linenos">536</span></a>                <span class="n">np</span><span class="o">.</span><span class="n">fromfunction</span><span class="p">(</span>
</span><span id="Model.density_gradient-537"><a href="#Model.density_gradient-537"><span class="linenos">537</span></a>                    <span class="k">lambda</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
</span><span id="Model.density_gradient-538"><a href="#Model.density_gradient-538"><span class="linenos">538</span></a>                        <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">center</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">j</span> <span class="o">-</span> <span class="n">center</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">),</span>
</span><span id="Model.density_gradient-539"><a href="#Model.density_gradient-539"><span class="linenos">539</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
</span><span id="Model.density_gradient-540"><a href="#Model.density_gradient-540"><span class="linenos">540</span></a>                <span class="p">)</span>
</span><span id="Model.density_gradient-541"><a href="#Model.density_gradient-541"><span class="linenos">541</span></a>                <span class="o">&lt;</span> <span class="n">radius</span>
</span><span id="Model.density_gradient-542"><a href="#Model.density_gradient-542"><span class="linenos">542</span></a>            <span class="p">)</span>
</span><span id="Model.density_gradient-543"><a href="#Model.density_gradient-543"><span class="linenos">543</span></a>            <span class="c1"># define the inner circle of the current ring</span>
</span><span id="Model.density_gradient-544"><a href="#Model.density_gradient-544"><span class="linenos">544</span></a>            <span class="n">inner_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfunction</span><span class="p">(</span>
</span><span id="Model.density_gradient-545"><a href="#Model.density_gradient-545"><span class="linenos">545</span></a>                <span class="k">lambda</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">i</span> <span class="o">-</span> <span class="n">center</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">j</span> <span class="o">-</span> <span class="n">center</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">),</span>
</span><span id="Model.density_gradient-546"><a href="#Model.density_gradient-546"><span class="linenos">546</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
</span><span id="Model.density_gradient-547"><a href="#Model.density_gradient-547"><span class="linenos">547</span></a>            <span class="p">)</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">radius</span> <span class="o">-</span> <span class="n">buffer_size</span><span class="p">)</span>
</span><span id="Model.density_gradient-548"><a href="#Model.density_gradient-548"><span class="linenos">548</span></a>            <span class="c1"># the difference between the outer and inner masks</span>
</span><span id="Model.density_gradient-549"><a href="#Model.density_gradient-549"><span class="linenos">549</span></a>            <span class="n">ring_mask</span> <span class="o">=</span> <span class="n">outer_mask</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">inner_mask</span>
</span><span id="Model.density_gradient-550"><a href="#Model.density_gradient-550"><span class="linenos">550</span></a>
</span><span id="Model.density_gradient-551"><a href="#Model.density_gradient-551"><span class="linenos">551</span></a>            <span class="c1"># calculate the number of cells and number of developed cells in</span>
</span><span id="Model.density_gradient-552"><a href="#Model.density_gradient-552"><span class="linenos">552</span></a>            <span class="c1"># the ring</span>
</span><span id="Model.density_gradient-553"><a href="#Model.density_gradient-553"><span class="linenos">553</span></a>            <span class="n">ring_cells</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ring_mask</span><span class="p">)</span>
</span><span id="Model.density_gradient-554"><a href="#Model.density_gradient-554"><span class="linenos">554</span></a>            <span class="n">developed_cells</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="n">ring_mask</span><span class="p">]</span> <span class="o">==</span> <span class="n">STRUCTURE</span><span class="p">)</span>
</span><span id="Model.density_gradient-555"><a href="#Model.density_gradient-555"><span class="linenos">555</span></a>
</span><span id="Model.density_gradient-556"><a href="#Model.density_gradient-556"><span class="linenos">556</span></a>            <span class="c1"># calculate density of the ring</span>
</span><span id="Model.density_gradient-557"><a href="#Model.density_gradient-557"><span class="linenos">557</span></a>            <span class="n">ring_density</span> <span class="o">=</span> <span class="n">developed_cells</span> <span class="o">/</span> <span class="n">ring_cells</span> <span class="k">if</span> <span class="n">ring_cells</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
</span><span id="Model.density_gradient-558"><a href="#Model.density_gradient-558"><span class="linenos">558</span></a>
</span><span id="Model.density_gradient-559"><a href="#Model.density_gradient-559"><span class="linenos">559</span></a>            <span class="k">if</span> <span class="n">ring_density</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">radius</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">:</span>
</span><span id="Model.density_gradient-560"><a href="#Model.density_gradient-560"><span class="linenos">560</span></a>                <span class="k">break</span>
</span><span id="Model.density_gradient-561"><a href="#Model.density_gradient-561"><span class="linenos">561</span></a>
</span><span id="Model.density_gradient-562"><a href="#Model.density_gradient-562"><span class="linenos">562</span></a>            <span class="n">densities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ring_density</span><span class="p">)</span>
</span><span id="Model.density_gradient-563"><a href="#Model.density_gradient-563"><span class="linenos">563</span></a>            <span class="n">distances</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="Model.density_gradient-564"><a href="#Model.density_gradient-564"><span class="linenos">564</span></a>                <span class="n">radius</span> <span class="o">-</span> <span class="n">buffer_size</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="Model.density_gradient-565"><a href="#Model.density_gradient-565"><span class="linenos">565</span></a>            <span class="p">)</span>  <span class="c1"># use the midpoint of the ring as the distance</span>
</span><span id="Model.density_gradient-566"><a href="#Model.density_gradient-566"><span class="linenos">566</span></a>
</span><span id="Model.density_gradient-567"><a href="#Model.density_gradient-567"><span class="linenos">567</span></a>        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span>
</span><span id="Model.density_gradient-568"><a href="#Model.density_gradient-568"><span class="linenos">568</span></a>            <span class="n">densities</span>
</span><span id="Model.density_gradient-569"><a href="#Model.density_gradient-569"><span class="linenos">569</span></a>        <span class="p">),</span> <span class="s2">&quot;Length of distances and densities must be equal&quot;</span>
</span><span id="Model.density_gradient-570"><a href="#Model.density_gradient-570"><span class="linenos">570</span></a>        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">),</span> <span class="s2">&quot;Distances must be positive&quot;</span>
</span><span id="Model.density_gradient-571"><a href="#Model.density_gradient-571"><span class="linenos">571</span></a>        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">densities</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">),</span> <span class="s2">&quot;Densities must be positive&quot;</span>
</span><span id="Model.density_gradient-572"><a href="#Model.density_gradient-572"><span class="linenos">572</span></a>        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">distances</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">distances</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="Model.density_gradient-573"><a href="#Model.density_gradient-573"><span class="linenos">573</span></a>                      <span class="p">),</span> <span class="s2">&quot;Distances must be sorted&quot;</span>
</span><span id="Model.density_gradient-574"><a href="#Model.density_gradient-574"><span class="linenos">574</span></a>
</span><span id="Model.density_gradient-575"><a href="#Model.density_gradient-575"><span class="linenos">575</span></a>        <span class="k">return</span> <span class="n">distances</span><span class="p">,</span> <span class="n">densities</span>
</span></pre></div>


            <div class="docstring"><p>Calculates the density gradient of the city.</p>

<p>The density gradient is calculated by dividing the city into rings of increasing radius and calculating the density of each ring.
The density of a ring is the number of developed cells in the ring divided by the number of cells in the ring.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>buffer_size</strong>:  The size of the buffer between rings</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>The distances and densities of the rings</p>
</blockquote>
</div>


                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>